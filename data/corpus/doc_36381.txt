Разработчики GNOME планируют миграцию на Wayland

Маттиас Класен (Matthias Clasen), разработчик GNOME из компании Red Hat, представил план реализации поддержки Wayland в GNOME. В соответствии с планом, начальная поддержка Wayland появится уже в GNOME 3.10, выход которого намечен на осень этого года, а полнофункциональная работа GNOME поверх Wayland ожидается в релизе 3.12, который выйдет весной 2014 года. В GNOME 3.10 по умолчанию по прежнему будет использоваться X-сервер, но будет добавлена опциональная возможность запуска оболочки GNOME Shell в качестве композитного сервера Wayland, для чего будет обеспечена поддержка базовых интерфейсов, идентичных с эталонным композитным сервером Weston. Одновременно будет доведён до готовности к ежедневному использованию бэкенд Wayland в GTK+. Поддержка Wayland в GNOME 3.10 будет позиционироваться как экспериментальная возможность, готовая для начального ознакомления, но не охватывающая все компоненты GNOME (например, ещё не будут доступны средства конфигурации дисплея, стек для обеспечения работы людей с ограниченными возможностями и поддержка планшетов Wacom). Из механизмов GNOME и GTK+, требующих отдельной доработки для функционирования в Wayland, отмечаются: работа с буфером обмена, настройка параметров экрана, Drag-and-Drop, методы ввода и управление раскладками клавиатуры, всплывающие окна, расширенные средства декорирования окон. Что касается приложений, то в настоящее время из 68 базовых программ поддержка Wayland присутствует в 35 приложениях, 26 программ требуют дополнительного портирования, 7 программ ещё не проверены. Для запуска обычных приложений, не поддерживающих работу поверх Wayland, будет задействован компонент XWayland, позволяющий обеспечить запуск обычных X11-приложений поверх Wayland. Версия GNOME 3.12 ознаменует собой создание полноценного порта GNOME на базе Wayland. Все базовые приложения будут поддерживать прямую работу с Wayland. Поддержка работы поверх X11 для большинства компонентов GNOME будет сохранена, но некоторые части GNOME смогут работать только с Wayland, так как в них достаточно трудно одновременно сохранить поддержку работы поверх X и Wayland. В анонсе отмечается, что намерение компании Canonical развивать собственный дисплейный сервер Mir поставило разработчиков перед выбором, на стороне какой технологии будет выступать проект GNOME. В итоге, разработчики решили сосредоточить свои усилия на помощи в реализации всего потенциала Wayland, сохранив своё мнение, что данный проект подходит на роль будущей дисплейной системы в Linux. Примечательно, что анонс проекта Mir и вспыхнувшие вокруг него обсуждения заметно форсировали развитие Wayland и подтолкнули разработчиков различных открытых проектов к его поддержке. Например, на днях обеспечена экспериментальная возможность работы медиацентра XBMC поверх Wayland. Для работы с Wayland портирован видеопроигрыватель Totem. Укрепились в своём решении обеспечить поддержку Wayland разработчики KDE. За последние несколько недель для Wayland/Weston разработан аналог XRandR для управления видеорежимами, создан протокол для минимизации и раскрытия окон, подготовлен композитный бэкенд на базе FreeRDP для работы удалённых клиентов, добавлена поддержка технологий PRIME/DMA_BUF для горячего переключения вывода с одного драйвера на другой и использования средств выноса операций DRI-рендеринга на другие GPU. В настоящее время Wayland достаточно хорошо работает с открытыми драйверами Intel, Radeon и Nouveau, в том числе с Gallium-драйверами из состава Mesa. Через использование прослойки libhybris могут быть задействованы драйверы для платформы Android. Проблему составляют проприетарные драйверы AMD и NVIDIA, с которыми не может работать Wayland, но и в этой области наблюдается прогресс - компания Canonical пытается договориться с AMD и NVIDIA о реализации для проекта Mir нового интерфейса на базе EGL, который может быть задействован и в Wayland.