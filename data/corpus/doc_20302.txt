Получение root привилегий через telnetd демон во FreeBSD (опубликован патч)

В telnetd демоне, входящем в состав FreeBSD 7.x, обнаружена критическая уязвимость, позволяющая локальному злоумышленнику получить привилегии суперпользователя в системе. Предположительно проблеме подвержены OpenBSD, NetBSD и другие системы. Эксплоит настолько прост, что вначале даже не верится, что он может работать. Уязвимость связана ненадлежащей чисткой переменных окружения перед вызовом /bin/login из telnetd (отсутствует чистка переменной окружения LD_PRELOAD, которую можно передать со стороны клиента, так как telnet протокол поддерживает передачу переменных окружения внутри сессии). Суть метода в подключении, через LD_PRELOAD простейшей библиотеки, запускающей /bin/sh в процедуре инициализации. Библиотека должна находиться на атакуемом хосте. При этом в момент подключения к локальному telnetd серверу, злоумышленник без аутентификации получает root shell. Теоретически на основе данной проблемы можно реализовать и сценарий удаленной атаки (например, библиотека может быть загружена через анонимный FTP, а путь к ней предугадан). Исправления уязвимости в настоящий момент не доступны, рекомендуется отключить telnet сервис, если он используется (по умолчанию telnetd отключен). Дополнение 1: Опубликован официальный отчет от службы реагирования на проблемы безопасности FreeBSD. Уязвимости подвержены только FreeBSD 7.0-RELEASE, 7.1-RELEASE, 7-STABLE и 8-CURRENT. Исправление уже присутствует в выпусках 7.0-RELEASE-p10, 7.1-RELEASE-p3, 7.1-STABLE и доступно в виде патча. Дополнение 2: Комментарий от Colin Percival, FreeBSD Security Officer. Дополнение 3: Кроме FreeBSD уязвимости подвержена DragonflyBSD.