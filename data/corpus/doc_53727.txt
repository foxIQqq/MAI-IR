Microsoft реализовал поддержку корневого окружения для Hyper-V на базе Linux

Компания Microsoft представила для обсуждения в списке рассылки разработчиков ядра Linux серию патчей, обеспечивающих работу гипервизора Hyper-V с корневым окружением на базе Linux, имеющим прямой доступ к оборудованию и применяемым для запуска гостевых систем (аналог Dom0 в Xen). До сих пор Hyper-V (Microsoft Hypervisor) поддерживал Linux лишь в гостевых окружениях, но сам гипервизор управлялся из окружения на базе Windows. Теперь компания Microsoft намерена создать полный стек виртуализации с Linux и Hyper-V. Организация работы гиперивизора в ядре Linux и Windows заметно отличается, поэтому в реализации Hyper-V для Linux применяются иной подход к настройке подсистем и организации гипервызовов. Код для маппинга прерываний с использованием IOMMU переделан по аналогии с аналогичным кодом поддержки Xen в Linux (Xen и Hyper-V имеют похожую архитектуру и базируются на использовании привилегированного корневого/Dom0 окружения для управления). Патчи включают минимально необходимую для работы реализацию, которая предложена как начальный прототип для обсуждения и критики. Для управления гипервизором предлагается устройство /dev/mshv при помощи которого приложения из пространства пользователя могут создавать и запускать виртуальные машины. Также предложен порт высокоуровневого гипервизора Cloud Hypervisor, позволяющий загружать виртуальные машины поверх Hyper-V вместо KVM. В 2018 году число гостевых систем с Linux в облачном сервисе Azure превысило окружения на базе Windows, доля которых неуклонно снижается, в основном благодаря росту популярности devops-платформ и Kubernetes, завязанных на Linux. Использование единого стека на базе Linux потенциально позволит упростить сопровождение и повысить производительность серверов Hyper-V, обслуживающих гостевые системы с Linux.