Обновление кодека Thusnelda в проекте Theora

На неделе вышла третья бета версия свободной библиотеки видеообработки Theora. По сравнению с первыми релизами проведена большая работа по улучшению качества картинки, которое теперь практически не зависит от сложности обрабатываемых сцен. Основное внимание разработчиков сейчас сконцентрировано на «доводке» функционала библиотеки, устранению последних недоработок, чистке кода и подготовке финальной версии Theora 1.1 (Thusnelda). Среди последних новшеств можно выделить следующие: Двухпроходное кодирование (two-pass encoding). Используется для получения файла с изначально заданными битрейтом или размером, при этом качество картинки остается практически как при кодировании с переменным битрейтом. Двухпроходный кодек, в отличие от однопроходного, не подвержен такой проблеме, когда простые сцены сжимаются с очень высоким качеством, а насыщенные — с низким. Отбрасывание кадров (Frame Dropping). Несмотря на явные преимущества двухпроходной кодировки, оно не пригодно для «живого» видео, особенно передаваемого по каналу с ограниченной полосой пропускания. В этом случае однопроходный кодек должен строго соблюдать заданные параметры линии связи. До недавнего времени у Theora возникали проблемы именно на низкоскоростных линиях, когда частота дискретизации уменьшалась до предельно допустимой величины. Функция отбрасывания кадров должна помочь не превышать требуемые параметры видеопотока при сохранении приемлимого качества изображения. Текущая реализация позволяет реализовать отбрасывание кадров только на буфере конечного размера. Поддержка переменной частоты кадров. Данная функция тесно связана с отбрасыванием кадров, однако используется для других целей. Здесь вместо отбрасывания кадры необходимо добавлять. Примером необходимости такой функции является создание анимации, когда начальную частоту кадров в 4 fps необходимо конвертировать в стандартные 24/30 fps. Адаптивная дискретизация (AQ). Theora всегда поддерживала эту функцию через индексирование фреймов. Тем не менее, ни один из кодеков адаптивную дискретизацию не использовал. Разработчик Tim Terriberry реализовал поддержку AQ для Thusnelda. Хроматическое сэмплирование 4:2:2 и 4:4:4. Декодирование этих сэмплов поддерживалось Theora в течение нескольких лет, но до текущего релиза ни один кодек их не использовал. Теперь Thusnelda имеет полную поддержку 4:2:2 и 4:4:4. Новая отладочная визуализация (Telemetry). Реализованы следующие режимы: визуализация векторами движения (motion vector visualization); режим макроблоков (macroblock mode); режим показа дискретизации (quantizer visualization); отображение количества битов, используемых для кодирования разных сцен (bit usage visualization).