Уязвимость в UEFI для процессоров AMD, позволяющая выполнить код на уровне SMM

Компания AMD сообщила о работе над исправлением серии уязвимостей "SMM Callout" (CVE-2020-12890), позволяющей получить контроль над прошивкой UEFI и выполнить код на уровне SMM (System Management Mode). Для атаки необходим физический доступ к оборудованию или доступ к системе с правами администратора. В случае успешной атаки злоумышленник может воспользоваться интерфейсом AGESA (AMD Generic Encapsulated Software Architecture) для выполнения произвольного кода, который невозможно выявить из операционной системы. Уязвимости присутствуют во входящем в состав прошивки UEFI коде, выполняемом в режиме SMM (Ring -2), более приоритетном, чем режим гипервизора и нулевое кольцо защиты, и имеющим неограниченный доступ ко всей системной памяти. Например, после получения доступа к ОС в результате эксплуатации других уязвимостей или методов социальной инженерии, атакующий может использовать уязвимости SMM Callout для обхода режима безопасной загрузки (UEFI Secure Boot), внедрения в SPI Flash невидимого для системы вредоносного кода или руткитов, а также для атак на гипервизоры для обхода механизмов проверки целостности виртуальных окружений. Уязвимости вызваны ошибкой в коде SMM, связанной с отсутствием проверки адреса целевого буфера при вызове функции SmmGetVariable() в SMI-обработчике 0xEF. Из-за данной ошибки атакующий может записать произвольные данные во внутреннюю память SMM (SMRAM) и запустить их как код с правами SMM. По предварительным данным проблема проявляется в некоторых APU (AMD Fusion) для пользовательских и встраиваемых систем, выпускавшихся с 2016 по 2019 год. Компания AMD уже передала большинству производителей материнских плат обновление прошивки с исправлением проблемы, а оставшимся производителям обновление планируется отправить до конца месяца.