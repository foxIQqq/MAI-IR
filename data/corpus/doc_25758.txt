Сервис Digg мигрирует с MySQL на БД Cassandra

Разработчики одного из крупнейших сетевых ресурсов Digg.com приняли решение отказаться от использования СУБД MySQL в пользу распределенной БД Apache Cassandra, исходные тексты которой были открыты компанией Facebook два года назад. Работа по уходу Digg от использования SQL заняла шесть месяцев, за которые не просто были переписаны все обеспечивающие работу сайта приложения, но и была полностью переработана архитектура клиентской и серверной части проекта. Главные мотивы ухода от использования MySQL: усложнение решений, при необходимости обеспечения высокой производительности и проблемы при интенсивной записи данных. Рост нагрузки заставлял разработчиков пересматривать стратегию горизонтального и вертикального партицирования (сегментирование записей по хранилищам в соответствии с определенным алгоритмом привязки к диапазону хранимых значений), при этом использование реляционной схемы приводило к большим накладным расходам. Переход на Cassandra связан не только с переходом на более оптимальную схему хранения данных, миграция также позволит дополнительно решить проблемы с синхронизацией данных при разнесении серверов по нескольким дата-центрам, повысит надежность хранения данных за счет их дублирования на разных машинах, даст возможность возложить на БД всю работу по замещению узлов в случае сбоя. БД Cassandra написана на языке Java и объединяет в себе полностью распределенную hash-систему Dynamo. Cassandra использует модель хранения данных на базе семейства столбцов (ColumnFamily), отличающуюся от систем подобных memcachedb, которые хранят данные только в связке ключ/значение, возможностью организовать хранение хэшей с несколькими уровнями вложенности. Cassandra относится к категории хранилищ повышенно устойчивых к сбоям: помещаемые в БД данные автоматически реплицируются на несколько узлов распределенной сети или даже равномерно распределяются по нескольким дата-центрам. При сбое узла, его функции на лету подхватываются другими узлами. Добавление новых узлов в кластер Cassandra также производится на лету, без дополнительного ручного вмешательства и переконфигурирования других узлов. В процессе перевода Digg на NoSQL-архитектуру изменению подвергся и код Cassandra, в который был добавлен ряд оптимизаций производительности, реализована новая схема кеширования на уровне столбцов, расширены средства по организации атомарных счетчиков, добавлена возможность одновременной выборки нескольких записей, переработана система ведения логов. В настоящий момент ведется работа по интеграции кода с реализацией всех улучшений в основное дерево исходных текстов Cassandra.