Удалённая root-уязвимость в Samba

Опубликованы корректирующие выпуски пакета 4.15.5, 4.14.12 и 4.13.17 с устранением 3 уязвимостей. Наиболее опасная уязвимость (CVE-2021-44142) позволяет удалённому атакующему выполнить произвольный код с правами root на системе с уязвимой версией Samba. Проблеме присвоен уровень опасности 9.9 из 10. Уязвимость проявляется только при использовании VFS-модуля vfs_fruit с параметрами по умолчанию (fruit:metadata=netatalk или fruit:resource=file), обеспечивающего дополнительный уровень совместимости с клиентами mac OS и улучшающего переносимость с файловыми серверами Netatalk 3 AFP. Проблема вызвана переполнением буфера в коде разбора метаданных с расширенными атрибутами (EA, xattr), вызываемого во время открытия файлов в smbd. Для осуществления атаки пользователь должен иметь доступ на запись к расширенным атрибутам файла, при том, что атака может быть проведена и гостевым пользователем, если ему разрешена подобная запись. Выпуск обновлений пакетов в дистрибутивах можно проследить на страницах: Debian, Ubuntu, RHEL, SUSE, Fedora, Arch, FreeBSD. В качестве обходного пути защиты можно удалить модуль "fruit" из списка "vfs objects" в smb.conf. Остальные две узвимости: Уязвимость CVE-2022-0336 позволяет пользователю Samba AD DC выдать себя за другой сервис и организовать перехват адресованного этому сервису трафика. Для атаки пользователь должен иметь право изменения атрибута servicePrincipalName в учётной записи. Уязвимость CVE-2021-44141 может привести к утечке информации о существовании файлов и каталогов в области ФС за пределами экспортируемого раздела Samba. Атака осуществляется через манипуляцию с символическими ссылками.