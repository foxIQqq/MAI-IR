Выявлена подстановка вредоносной зависимости в ночные сборки PyTorch

Разработчики фреймворка машинного обучения PyTorch предупредили пользователей о выявлении подстановки вредоносной зависимости, выполняемой при использовании ночных сборок проекта. Проблема затрагивает только экспериментальные ночные сборки PyTorch (PyTorch-nightly), пакеты со стабильными выпусками не пострадали. Вредоносная зависимость распространялась с 25 по 30 декабря 2022 года и была нацелена на компрометацию Linux-систем разработчиков, использующих тестовые сборки PyTorch. Для совершения вредоносных действий атакующие воспользовались методом подмены зависимостей и загрузили в репозиторий PyPI пакет torchtriton, имеющий то же имя, что и пакет, размещённый в собственном репозитории PyTorch-nightly. Метод основан на том, что при использовании дополнительных репозиториев пакетный менеджер pip пытается загрузить внутренние зависимости и из публичных репозиториев, учитывая номер версии. Таким образом, при установке ночных сборок PyTorch пакетный менеджер pip обнаруживал более новый пакет torchtriton в репозитории PyPI и устанавливал его, вместо одноимённого пакета из репозитория PyTorch-nightly. В опубликованную атакующими версию torchtriton был добавлен код для запуска исполняемого файла ("PYTHON_SITE_PACKAGES/triton/runtime/triton"), который осуществлял поиск и отправку конфиденциальных данных с систем, работающих под управлением Linux. Среди прочего злоумышленникам отправлялась информация о системе (/etc/resolv.conf, /etc/hosts, /etc/passwd, переменные окружения, данные об учётной записи), а также содержимое $HOME/.gitconfig, $HOME/.ssh/* и первых 1000 файлов в домашнем каталоге, размером менее 100 КБ. Данные передавались через туннель, организованный поверх DNS (отправлялись шифрованные DNS-запросы к DNS-серверу атакующих). По имеющейся статистике вредоносный пакет torchtriton был загружен более 2000 раз. Разработчикам, которые устанавливали PyTorch-nightly или torchtriton с 25 по 30 декабря 2022 года, рекомендуется проверить своё окружение на предмет вредоносной активности. Проблему сглаживает то, что вредоносный код запускался только при импорте пакета triton, что не является поведением PyTorch по умолчанию и требует использования определённого кода. Для проверки наличия вредоносного пакета torchtriton можно использовать следующую команду: python3 -c "import pathlib;import importlib.util;s=importlib.util.find_spec('triton'); affected=any(x.name == 'triton' for x in (pathlib.Path(s.submodule_search_locations[0] if s is not None else '/' ) / 'runtime').glob('*'));print('You are {}affected'.format('' if affected else 'not '))" Дополнение: Опубликован анализ использованного вредоносного кода.