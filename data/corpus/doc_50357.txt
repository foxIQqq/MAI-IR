Выпуск Samba 4.10.0

Опубликован релиз Samba 4.10.0, продолживший развитие ветки Samba 4 с полноценной реализацией контроллера домена и сервиса Active Directory, совместимого с реализацией Windows 2000 и способного обслуживать все поддерживаемые Microsoft версии Windows-клиентов, в том числе Windows 10. Samba 4 является многофункциональным серверным продуктом, предоставляющим также реализацию файлового сервера, сервиса печати и сервера идентификации (winbind). Ключевые изменения в Samba 4.10: В KDC и Netlogon добавлена поддержка модели запуска процессов "pre-fork", позволяющей поддерживать пул заранее запущенных процессов-обработчиков. Значение по молчанию параметра 'prefork children' в smdb.conf увеличено с 1 до 4; В реализации модели pre-fork обеспечен автоматический перезапуск сбойных процессов. Задержки между попытками повторного запуска определяются через параметры "prefork backoff increment" (по умолчанию 10 секунд) и "prefork maximum backoff" (по умолчанию 120 секунд) - при каждой новой попытке время перед повторным запуском увеличивается на "prefork backoff increment" пока не достигнет значения "prefork maximum backoff" (для значений по умолчанию раскладка задержек будет следующей: 0, 10, 20, ..., 120, 120, ...); В стандартной модели запуска процессов, применяемой по умолчанию для ответвления новых процессов ldap и netlogon при поступлении новых запросов, реализована возможность ограничения максимального числа запущенных процессов (лимит регулируется параметром 'max smbd processes' в smb.conf, по умолчанию значение 0, т.е. без ограничений); Обеспечена полноценная поддержка языка Python 3. Поддержка Python 2 пока сохранена, но по умолчанию при сборке теперь используется Python 3 (Python 3.4+). Для сборки с Python 2 требуется установка переменной окружения: "PYTHON=python2 ./configure; PYTHON=python2 make". Сборка samba-биндингов возможна одновременно для Python 3 и Python 2 через указания флага 'configure --extra-python=/usr/bin/python2'. В ветке Samba 4.11 планируется прекратить поддержку Python 2 для биндингов и поднять требования к версии до Python 3.6; Добавлена команда 'samba-tool gpo backup', позволяющая экспортировать из домена набор объектов GPO (Group Policy Objects) в формате XML. Также добавлена команда 'samba-tool gpo restore' для импорта обобщённых данных GPO из XML; В команду 'samba-tool domain backup' добавлена поддержка опции 'offline', позволяющей безопасно создавать резервные копии локальной БД контроллера домена напрямую с диска. Новый метод не требует запуска Samba, работает быстре и включает дополнительные детали о внутренней структуре хранилища; Добавлена команда 'samba-tool group stats', выводящая сводные сведения о распределении пользователей между группами в домене. Существующая команда 'samba-tool group list --verbose' расширена данными о числе пользователей в каждой группе; Для LDAP изменено поведение расширения Paged Results, позволяющего частями обрабатывать результаты запросов с разбиением данных на страницы. Обработка страничных запросов в Samba приведена в соответствие с поведением серверов Windows (раньше разные страницы в выборке отдаваться на основе неизменного статического слепка БД, а сейчас учитывают изменения в БД, полученные с момента прошлого страничного запроса); В выводимых в JSON-лог сообщениях аутентификации добавлено отображение идентификатора события ("eventId", код успешного или не успешного входа) и типа входа ("logonType", интерактивный, сетевой и незащищённый сетевой). В сообщениях о смене пароля и изменении участия в группе также теперь отображается "eventId" (пароль изменён, пароль сброшен, добавлен/удалён член группы). Изменён формат JSON-записей (убран префикс "JSON message_type:"); В утилиту samba-tool добавлена поддержка протокола SMBv2 (ранее samba-tool не мог подключаться к внешнему контроллеру домена, на котором был отключен SMBv1); Добавлен новый VFS-модуль glusterfs_fuse, позволяющий увеличить производительность при обращении через Samba к разделам с GlusterFS, примонтированным с применением механизма FUSE (Filesystem in Userspace). Для повышения производительности модуль напрямую извлекает информацию об именах файлов через запрос расширенных атрибутов в ФС. Для включения ускорения достаточно добавить glusterfs_fuse в параметр "vfs objects". Новый модуль не заменяет собой vfs_glusterfs, а лишь предлагает альтернативный механизм доступа к разделам Gluster; Объявлены устаревшими и будут удалены в следующей ветке Python-биндинги к SMB client. Удаление повлияет на пользователей, использующих собственные утилиты с 'from samba import smb'; Из-за наличия потенциальных проблем с безопасностью возможность сборки MIT Kerberos для AD DC переведена в разряд экспериментальных опций и требует явного указания в configure флага "--with-experimental-mit-ad-dc"; Удалён скрипт samba_backup, вместо которого следует использовать команду 'samba-tool domain backup offline'.