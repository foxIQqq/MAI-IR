Обход правил межсетевого экрана с использованием модулей трекинга FTP-соединений

В рассылке netfilter-devel опубликован способ обхода правил фильтрации iptables с использованием модуля nf_conntrack_ftp. Злоумышленник может получить доступ к любому порту на атакуемой машине как только пользователь откроет специально сформированную веб-страницу. Весь процесс происходит совершенно незаметно для пользователя и не требует каких-то особых разрешений для веб-браузера. Вкупе с модулем nf_nat_ftp, метод позволяет также получать доступ к произвольным портам хостов локальной сети, находящимися за NAT. Продемонстрированный эффект не вызван ошибкой разработчиков, а является проблемой слабо защищенной, но довольно распространенной конфигурации. Для эксплуатации уязвимости могут быть также использованы и другие способы с другими хелперами conntrack. Рекомендуется проверить конфигурацию и/или временно отключить модули nf_conntrack_ftp, sip и подобные. Например, при использовании модуля nf_conntrack_ftp в сочетании с набором правил: iptables -A INPUT -i lo -j ACCEPT iptables -A INPUT -p icmp -j ACCEPT iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT iptables -A INPUT -p tcp --dport 80 -j ACCEPT iptables -P INPUT DROP iptables -P OUTPUT -j ACCEPT или iptables -A FORWARD -s 192.168.0.0/24 -o eth1 -j ACCEPT iptables -A FORWARD -d 192.168.0.0/24 -i eth1 -j ACCEPT iptables -P FORWARD DROP iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth1 -j SNAT --to-source x.x.x.x sysctl -w net.ipv4.conf.all.forwarding=1 Несмотря на ограничения, пользователь может подсоединиться к внешнему ftp серверу в активном режиме и выполнить реконнект на произвольный локальный порт, даже если он закрыт пакетным фильтром от внешней сети: USER anonymous PASS test@example.com PORT x,x,x,x,y,z Создав на удаленном сервере специальный скрипт на Flash, Java или JavaScript (XMLHTTPRequest), злоумышленник может сэмулировать сессию с conntack-модулем, выступая в роли фиктивного FTP-сервера.