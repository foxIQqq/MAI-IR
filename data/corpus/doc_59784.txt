Microsoft опубликовал WSL 2.0.0, прослойку для запуска Linux-приложений в Windows

Компания Microsoft представила выпуск прослойки для запуска Linux-приложений в Windows - WSL 2.0.0 (Windows Subsystem for Linux). Для обеспечения запуска исполняемых файлов Linux в WSL предоставляется окружение с полноценным ядром Linux, основанном на выпуске ядра Linux 5.15, который расширен специфичными для WSL патчами, включающими оптимизации для сокращения времени запуска ядра, уменьшения потребления памяти, возвращения Windows освобождённой Linux-процессами памяти, оставления в ядре минимально необходимого набора драйверов и подсистем. Ядро Linux выполняется в окружении Windows при помощи виртуальной машины, которая использует отдельный дисковый образ (VHD) c файловой системой ext4 и виртуальным сетевым адаптером. Компоненты пространства пользователя устанавливаются отдельно и базируются на сборках различных дистрибутивов. Например, для установки в WSL в каталоге Microsoft Store предлагаются сборки Ubuntu, Debian GNU/Linux, Kali Linux, Fedora, Alpine, SUSE и openSUSE. Среди наиболее заметных изменений в версии WSL 2.0.0: Реализована экспериментальная настройка autoMemoryReclaim (добавляется в %USERPROFILE%\.wslconfig), активирующая автоматическое высвобождение памяти, занимаемой в Linux под кэши, после нахождения процессора в состоянии простоя в течение 5 минут. Высвобожденная в Linux-окружении память возвращается в основное окружение с Windows, т.е. неиспользуемые виртуальные машины с Linux автоматически начинают потреблять меньше памяти. Добавлена экспериментальная настройка sparseVhd, которая включает для новых образов VHD (Virtual Hard Disk) режим автоматического уменьшения размера. По аналогии с тем, как VHD-образы могут автоматически увеличиваться при увеличении объёма данных в Linux-окружении, теперь они также могут и уменьшаться при удалении данных из Linux-окружения. Для включения режима "sparse" для уже существующих дистрибутивов предложена опция "--set-sparse", например "wsl --manage <distro> --set-sparse <true/false>". Добавлена экспериментальная настройка networkingMode, при указании в которой значения "mirrored" для обеспечения сетевого доступа используется зеркалирование в Linux сетевых интерфейсов Windows, вместо применения транслятора адресов. Новый режим отличается возможностью использования IPv6 и Multicast, улучшением совместимости с VPN, поддержкой прямого подключения к WSL из локальной сети, поддержкой подключения к Windows-серверам, используя localhost (127.0.0.1). Добавлена экспериментальная настройка dnsTunneling, позволяющая пробрасывать DNS-запросы через резолвер, предоставляемый платформой Windows. Добавлена экспериментальная настройка firewall, включающая применение для фильтрации трафика Linux-окружения правил межсетевых экранов Windows (Windows Firewall) и Hyper-V (Hyper-V Firewall). Добавлена экспериментальная настройка autoProxy, добавляющая возможность использования в Linux-окружении информации о настройках HTTP-прокси из Windows. Для графических приложений, запускаемых при помощи WSL, реализована поддержка прикрепления окон клавиатурной комбинацией "WIN + одна из клавиш управления курсором". Все исполняемые файлы, распространяемые через пакет WSL, снабжены цифровыми подписями. Используемое в WSL-окружении ядро Linux обновлено до версии 5.15.123. Мини-дистрибутив WSLg, в котором предоставляются компоненты графического стека для организации запуска GUI-приложений, обновлён до версии 1.0.57.