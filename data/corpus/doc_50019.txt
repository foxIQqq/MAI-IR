Новая критическая уязвимость в Ghostscript, эксплуатируемая через ImageMagick

Объявлено в выявлении новой критической уязвимости (CVE-2019-6116) в Ghostscript, наборе инструментов для обработки, преобразования и генерации документов в форматах PostScript и PDF. Уязвимость позволяет организовать выполнение произвольного кода в системе при обработке специально оформленных документов. Это 14 опасная уязвимость, выявленная в Ghostscript за последние 6 месяцев. На этот раз для обхода режима изоляции "-dSAFER" использованы особенности обработки подпрограмм с псевдооператорами. Проблема проявляется в том числе в последнем выпуске 9.26 и пока решается только наложением 6 патчей (1, 2, 3, 4, 5, 6). В дистрибутивах проблема уже устранена в SUSE/openSUSE, Ubuntu, RHEL. Проблема остаётся неисправленной в Debian и Fedora. Для проверки своих систем доступен прототип эксплоита. Напомним, что уязвимости в Ghostscript представляют повышенную опасность, так как данный пакет используется во многих популярных приложениях для обработки форматов PostScript и PDF. Например, Ghostscript вызывается в процессе создания миниатюр на рабочем столе, при фоновой индексации данных и при преобразовании изображений. Для успешной атаки во многих случаях достаточно просто загрузить файл с эксплоитом или просмотреть каталог с ним в Nautilus. Уязвимости в Ghostscript также можно эксплуатировать через обработчики изображений на базе пакетов ImageMagick и GraphicsMagick, передав в них JPEG или PNG-файл, в котором вместо картинки находится код PostScript (такой файл будет обработан в Ghostscript, так как MIME-тип распознаётся по содержимому, а не полагаясь на расширение). В качестве обходного пути защиты от эксплуатации уязвимости через автоматический построитель миниатюр в GNOME и ImageMagick рекомендуется переименовать исполняемый файл /usr/bin/evince-thumbnailer и запретить обработку форматов PS, EPS, PDF и XPS в ImageMagick, для чего в секцию "policymap" файла конфигурации /etc/ImageMagick/policy.xml следует добавить: <policy domain="coder" rights="none" pattern="PS" /> <policy domain="coder" rights="none" pattern="PS2" /> <policy domain="coder" rights="none" pattern="PS3" /> <policy domain="coder" rights="none" pattern="EPS" /> <policy domain="coder" rights="none" pattern="PDF" /> <policy domain="coder" rights="none" pattern="XPS" />