Выпуск серверной JavaScript-платформы Node.js 15.0

Состоялся релиз Node.js 15.0, платформы для выполнения сетевых приложений на языке JavaScript. Node.js 15.0 относится к ветке с обычным сроком поддержки, обновления для которой будут выпускаться до июня 2021 года. В ближайшие дни будет завершена стабилизация ветки Node.js 14, которая получит статус LTS и будет поддерживаться до апреля 2023 года. Сопровождение прошлой LTS-ветки Node.js 12.0 продлится до апреля 2022 года, а позапрошлой LTS-ветки 10.0 до апреля 2021 года. Основные улучшения: Добавлена экспериментальная реализация класса AbortController, основанного на Web API AbortController и позволяющего отменять сигналы в выбранных API на основе Promise. N-API (API для разработки дополнений) обновлён до версии 7, в которой появились новые методы для работы с ArrayBuffers. Движок V8 обновлён до версии 8.6, что позволило реализовать в Node.js 15 такие возможности, как Promise.any(), AggregateError, String.prototype.replaceAll(), а также операторы логического присвоения "&&=", "||=" и "??=". Осуществлён переход на новый выпуск пакетного менеджера NPM 7.0, в котором появилась поддержка рабочих областей (Workspaces) для объединения зависимости из нескольких пакетов в один пакет, реализована автоматическая установка peer-зависимостей, предложена вторая версия формата блокировок (package-lock.json v2) и поддержка файла-блокировки yarn.lock. Обработчик unhandledRejection переключен на использование по умолчанию исключений "throw" вместо предупреждений "warn". В режиме "throw", при отсутствии явно определённого обработчика, unhandledRejection теперь генерирует неперехватываемое исключение, но если обработчик задан поведение не изменится. Для возвращения старого поведения предусмотрен флаг "--unhandled-rejections=warn". В модуль "net" добавлена экспериментальная поддержка протокола QUIC, который лежит в основе HTTP/3 и рассматривается как альтернатива связке TCP+TLS для Web, решающая проблемы с большим временем установки и согласования соединений в TCP и устраняющая задержки при потере пакетов в процессе передачи данных. QUIC представляет собой надстройку над протоколом UDP, поддерживающую мультиплексирование нескольких соединений и обеспечивающую методы шифрования, эквивалентные TLS/SSL. Для включения поддержки QUIC в Node.js требуется сборка с флагом "--experimental-quic". Напомним, что платформа Node.js может быть использована как для серверного сопровождения работы Web-приложений, так и для создания обычных клиентских и серверных сетевых программ. Для расширения функциональности приложений для Node.js подготовлена большая коллекция модулей, в которой можно найти модули с реализацией серверов и клиентов HTTP, SMTP, XMPP, DNS, FTP, IMAP, POP3, модули для интеграции с различными web-фреймворками, обработчики WebSocket и Ajax, коннекторы к СУБД (MySQL, PostgreSQL, SQLite, MongoDB), шаблонизаторы, CSS-движки, реализации криптоалгоритмов и систем авторизации (OAuth), XML-парсеры. Для обеспечения обработки большого числа параллельных запросов Node.js задействует асинхронную модель запуска кода, основанную на обработке событий в неблокирующем режиме и определении callback-обработчиков. В качестве способов мультиплексирования соединений поддерживаются такие методы, как epoll, kqueue, /dev/poll и select. Для мультиплексирования соединений используется библиотека libuv, которая является надстройкой над libev в системах Unix и над IOCP в Windows. Для создания пула потоков (thread pool) задействована библиотека libeio, для выполнения DNS-запросов в неблокирующем режиме интегрирован c-ares. Все системные вызовы, вызывающие блокирование, выполняются внутри пула потоков и затем, как и обработчики сигналов, передают результат своей работы обратно через неименованный канал (pipe). Выполнение JavaScript-кода обеспечивается через задействование разработанного компанией Google движка V8 (дополнительно Microsoft развивает вариант Node.js с движком Chakra-Core). По своей сути Node.js похож на фреймворки Perl AnyEvent, Ruby Event Machine, Python Twisted и реализацию событий в Tcl, но цикл обработки событий (event loop) в Node.js скрыт от разработчика и напоминает обработку событий в web-приложении, работающем в браузере. При написании приложений для node.js необходимо учитывать специфику событийно-ориентированного программирования, например, вместо выполнения "var result = db.query("select..");" с ожиданием завершения работы и последующей обработкой результатов, в Node.js использует принцип асинхронного выполнения, т.е. код трансформируется в "db.query("select..", function (result) {обработка результата});", при котором управление мгновенно перейдёт к дальнейшему коду, а результат запроса будет обработан по мере поступления данных.