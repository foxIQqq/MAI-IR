Для OpenBSD представлена новая техника рандомизации адресного пространства ядра

Тео де Раадт (Theo de Raadt) представил новую технику рандомизации адресного пространства ядра KARL (Kernel Address Randomized Link), нацеленную на усиления защиты от атак, связанных с манипуляцией структурами и кодом ядра. KARL вводит в обиход новую модель отражения страниц памяти (mapping), при которой все относительные указатели между функциями и данными ядра никогда не повторяются между перезагрузками системы. В отличие от классической техники рандомизации памяти, которая затрагивает только операции распределения памяти, новая техника позволяет изменить первичную раскладку виртуального адресного пространства ядра. Метод достаточно прост в реализации и не требует переработки подсистем ядра - при каждой перезагрузке системы предлагается выполнять операцию перекомпоновки ядра, формируя исполняемый файл ядра на основе подключения объектных модулей и runtime-компонентов в случайном порядке. Таким образом, при каждой перезагрузке формируется уникальный экземпляр ядра, раскладка структур в котором заранее неизвестна. Компоновка осуществляется из rc-скриптов и замедляет загрузку примерно на секунду. При каждой загрузке генерируется ядро для следующей загрузки. Единственным повторяющимся известным адресом в подобных ядрах является точка активации кода начального запуска (bootstrap), поэтому для защиты от манипуляции с ним после завершения инициализации ядра выполнение bootstrap-кода блокируется через установку TRAP или выполнение unmap, в зависимости от используемой архитектуры.