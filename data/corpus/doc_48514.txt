Уязвимости в гипервизоре Xen

В гипервизоре Xen найдена уязвимость, которая может быть использована для организации утечки информации из файловой системы хост-окружения. При обработке в гостевой системе специально оформленного образа CDROM имеется возможность получить доступ на чтение к любому файлу на стороне хост-системы с правами процесса с обработчиком устройств qemu. Проблеме подвержены только гостевые системы x86, работающие в режиме HVM, в которых присутствует устройство виртуального CDROM. Проблема не затрагивает гостевые системы, работающие в режиме паравиртуализации (PV и PVH), а также системы HVM без виртуального устройства CDROM. Для проявления уязвимости на стороне dom0 должен быть запущен процесс qemu из пакета qemu-xen (системы с stub-доменом и qemu-xen-traditional не подвержены проблеме). Для эксплуатации уязвимости атакующий должен иметь возможность инициировать загрузку своего raw-образа в виртуальном CDROM, т.е. проблема затрагивает только конфигурации, в которых владельцам гостевых систем разерешено загружать свои образы в виртуальный CDROM. Уязвимость легко блокируется, если принимая от пользователя raw-файл, принудительно преобразовывать его в какой-то специфичный формат ("-f raw" важен, чтобы не натолкнуться на ту же самую проблему, что и в самом QMP, вызванную неаккуратным автоугадыванием формата содержимого образа): qemu-img convert -f raw -O qcow2 untrusted.raw wrapped.qcow2 Дополнительно можно отметить ещё одну уязвимость в Xen, связанную с ошибкой в реализации защиты от атаки Meltdown (XPTI). Уязвимость позволяет владельцу гостевой системы, работающей в режиме паравиртуализации (PV), вызвать крах гипервизора и парализовать работу хост-окружения. Уязвимость вызвана отсутствием обработчика ошибок для INT 80, что позволяет вызвать крах гипервизора через попытку записи нулевого значения по адресу в области 2^64. Проблеме подвержены только x86-системы, в которых применён патч XSA-254 для защиты от Meltdown. В гостевых системах PVH и HVM проблема не проявляется.