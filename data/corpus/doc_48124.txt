Релиз почтового сервера Postfix 3.3.0

После года разработки состоялся релиз новой стабильной ветки почтового сервера Postfix - 3.3.0. В то же время объявлено о прекращении поддержки ветки Postfix 2.11, выпущенной в начале 2014 года. Postfix является одним из редких проектов, сочетающих одновременно высокую безопасность, надёжность и производительность, чего удалось добиться благодаря продуманной архитектуре и достаточно жесткой политике оформления кода и аудита патчей. Позавчера проект отметил 21 год с момента формирования первой сборки 20 февраля 1997 года, которая включала библиотеку функций и базовый обработчик, уложившиеся в 8086 строк кода (4204 без комментариев). В соответствии с данными, полученными в результате автоматизированного опроса около двух миллионов почтовых серверов, Postfix используется на 33.79% (год назад 33.07%) почтовых серверов, доля Exim составляет 56.8% (56.02%), Sendmail - 4.43% (5.06%), Microsoft Exchange - 0.81% (1.14%). Основные новшества Postfix 3.3.0: Переход на двойную лицензию. В дополнение к изначальной используемой жесткой копилефт лицензии IBM Public License (IPL) 1.0, код Postfix теперь также доступен и под лицензией Eclipse Public License (EPL) 2.0, которая относится к категории слабого копилефта, при котором изменения требуется открывать только при поставке продукта, содержащего модифицированную версию кода (для внутреннего использования изменения могут вноситься без их открытия). В своё время поставка Postfix под лицензией IPL не позволила включить его в базовый состав OpenBSD и привела к созданию проектом OpenBSD собственного SMTP-сервера; В утилите postconf обеспечен вывод предупреждений при использовании неизвестных имён параметров в конфигурационных файлах с базами данных; Средства для запуска в изолированном контейнере: при помощи новой команды "postfix start-fg" Postfix теперь можно запустить без перехода в фоновый режим. Для проброса логов на сторону хоста нужно примонтировать в контейнер сокет /dev/log (например, при помощи команды "docker run -v /dev/log:/dev/log") и указать отдельное имя для записи в лог ("postconf syslog_name=имя"); Поддержка Milter расширена возможностью отправки приложениями параметров RET и ENVID в запросах SMFIR_CHGFROM (изменение адреса отправителя); По умолчанию применена новая схема форматирования содержимого заголовка "From:" для писем, сгенерированных в Postfix. Вместо ранее применявшегося синтаксиса "From: address (name)" теперь используется "From: name <address>". Для возврата старого поведения следует указать в настройках "header_from_format = obsolete"; При включении поддержки одновременно IPv6 и IPv4 SMTP-клиент Postfix теперь пытается равномерно распределять отправки запросов по IPv6 и IPv4, независимо от числа фактически заявленных для MX адресов каждого типа. Предложенный метод балансировки позволяет избежать проблем с доставкой, когда для MX заявлено большое число адресов IPv6, но на деле работоспособен только IPv4 и наоборот. Для настройки поведения можно использовать параметр smtp_balance_mx_inet_protocols; При запуске в режиме совместимости настроек по умолчанию с прошлыми ветками Postfix (compatibility_level меньше 1), SMTP-сервер теперь лишь выдаёт предупреждение (но не блокирует) для почты, которая раньше блокировалась в силу настройки smtpd_relay_restrictions; В параметре pgsql_table добавлена поддержка URI "postgresql://"; В SMTP-сервере разрешено использование команды XCLIENT до STARTTLS при применении TLS, что может быть полезным для организации работы серверов, размещённых за reverse-proxy, например, за nginx.