Доступен Wayland 1.17

Состоялся стабильный релиз протокола, механизма межпроцессного взаимодействия и библиотек Wayland 1.17. Ветка 1.17 обратно совместима на уровне API и ABI с выпусками 1.x, но дополнительно содержит порцию улучшений. Кроме устранения проблем и недоработок в Wayland 1.17 переработан код для вывода сведений о внутренних ошибках сервера, обновлён протокол wl_seat и обеспечено приоритетное использование wl_surface.damage_buffer. Ожидавшийся сегодня выпуск композитного сервера Weston 6.0 отложен до конца недели из-за выявления в последний момент ошибки в сценариях сборки meson, исправления для которых требуют дополнительного тестирования. Напомним, что в Weston развиваются технологии, содействующие появлению полноценной поддержки протокола Wayland в Enlightenment, GNOME, KDE и других пользовательских окружениях. Разработка Weston нацелена на предоставление высококачественной кодовой базы и рабочих примеров для использования Wayland в десктоп-окружениях и встраиваемых решениях, таких как платформы для автомобильных информационно-развлекательных систем, смартфонов, телевизоров и прочих потребительских устройств. Смена значительного номера версии Weston обусловлена изменениями ABI, нарушающими совместимость. В новой ветке Weston: Добавлены сценарии сборки на базе системы meson (поддержка autotools сохранена, но требует указания флага "--enable-autotools" в configure). Обеспечена поддержка стабильного протокола xdg-shell (интерфейс для создания и взаимодействия с поверхностями как с окнами). В compositor-drm добавлена поддержка виртуального устройства вывода (настраивается в секции remote-output в weston.ini). Добавлен плагин "remoting" для потоковой трансляции вывода на внешние хосты с использованием виртуального устройства вывода. Плагин запускается автоматически при наличии настроек виртуального вывода. Информация передаётся через отправку motion jpeg через RTP при помощи gstreamer. На удалённой стороне для просмотра достаточно любого RTP-клиента (на базе gstreamer также подготовлен скрипт remoting-client-receive.bash). Добавлена реализация клиента simple-dmabuf-egl с поддержкой совместного использования нескольких видеокарт при помощи технологии DMABuff. В libweston добавлен API для управления конфигурацией (weston_config), флаг для проверки прозрачности (is_opaque в weston_surface) и средства синхронизации на базе вызова sync_file (zwp_linux_explicit_synchronization_v1). Добавлен API для отладки и специальный отладочный режим работы с выводом детальных логов (опция weston_debug). Расширены возможности оболочки для автомобильных информационно-развлекательных систем (ivi-shell). Добавлены дополнительные настройки ввода для libinput. Улучшена поддержка буфера обмена в xwayland. Обеспечена установка weston-screenshooter. Добавлена настройка для включения отрисовки на базе библиотеки pixman. В gl-renderer добавлена поддержка синхронизации GPU через fence sync fd. Статус поддержки Wayland в приложениях, окружениях рабочего стола и дистрибутивах: В Firefox 65 включена штатная поддержка работы в графических окружениях на основе протокола Wayland. Для использования Wayland теперь достаточно запустить Firefox с переменной окружения GDK_BACKEND, выставленной в значение "wayland"; В Fedora 30 решено поставлять по умолчанию сборку Firefox на базе Wayland; В GTK+ 3.24 в бэкенд, обеспечивающий работу поверх дисплейного сервера Wayland, добавлена поддержка протоколов ввода gtk-text-input и text-input-unstable-v3, обеспечено масштабирование курсора, а также устранены многие проблемы; Панель рабочего стола MATE 1.22 адаптирована для работы под управлением бэкенда на основе протокола Wayland; В GNOME 3.32 для сеанса на базе Wayland реализована поддержка дробного масштабирования; Компания BMW открыла систему распределённой отрисовки RAMSES, поддерживающую Wayland; Доступен первый стабильный выпуск пользовательского окружения Sway 1.0, использующего Wayland; Опубликован Cage, композитный сервер на базе Wayland для запуска отдельных приложений в режиме киоска; В KDE 5.15 полностью реализованы протоколы XdgStable, XdgPopups и XdgDecoration. В окружениях на базе Wayland обеспечена поддержка виртуальных рабочих столов, в том числе добавлена возможность выборочного размещения окна на заданных виртуальных рабочих столах (при использовании X11 подобной возможности нет и окно можно поместить либо на один виртуальный рабочий стол, либо на все). Добавлена поддержка перемещения элементов в режиме drag&drop при помощи жеста на сенсорном экране или тачпаде; В мультимедийном центре Kodi 18.0 представлена поддержка Wayland; В бета-версии Red Hat Enterprise Linux 8 рабочий стол GNOME по умолчанию использует Wayland; В дисплейном сервере Mir стабилизированы средства для запуска Wayland-приложений и использования Mir в качестве композитного сервера для Wayland; Дистрибутив Lubuntu наметил переход на Wayland на 2020 год. Поддержку Wayland планируется реализовать через портирование оконного менеджера Openbox на использование дисплейного сервера Mir, применяемого в качестве композитного сервера для Wayland; Развивается проект AsteroidOS, в рамках которого предложена открытая ОС для умных часов, использующая Qt5 и Wayland; Обеспечена поддержка Wayland в панели Latte Dock; В рамках подготовки будущего стабильного релиза GTK+ 4 ведётся работа по модернизации API в контексте поддержки Wayland. Реализована новая платформа методов ввода, базирующаяся на протоколе Wayland; В openSUSE Leap 15 предложен опциональный сеанс KDE на базе Wayland. При выборе GNOME по умолчанию предлагается Wayland; В SUSE Linux Enterprise 15 задействован рабочий стол GNOME 3.26, по умолчанию работающий поверх Wayland; Подготовлен тестовый выпуск платформы Tizen 5.0, по умолчанию использующей Wayland. Бэкенд Qt Wayland добавлен в состав базовых сборок Qt. Развиваемая проектом Qt платформа для автомобильных систем Qt Automotive Suite включает Qt Wayland Compositor, многопоточную систему отрисовки для встраиваемых устройств, использующую протокол Wayland; Продолжается работа над выпуском пользовательского окружения LXQt 1.0.0, главной задачей при разработке которого является доведение до полной готовности возможности работы поверх Wayland; Fedora 29 стал пятым выпуском, в котором по умолчанию предложен сеанс GNOME на базе Wayland; В разрабатываемой компанией LG открытой платформе webOS Open Source Edition развивается новый композитный менеджер, основанный на протоколе Wayland; Продолжатся работа по улучшению поддержки Wayland в Enlightenment; В дисплейном сервере Mir развивается возможность работы клиентов Wayland, что позволяет организовать запуск Wayland-приложений в окружении Mir, используя Mir в качестве композитного сервера для Wayland; Система вывода в механизме для запуска виртуальных машин с Linux в ChromeOS предоставляет встроенную поддержку Wayland-клиентов (virtio-wayland) с выполнением композитного сервера на стороне основного хоста и возможностью эффективного использования GPU из гостевых систем; Для FreeBSD развиваются порты, необходимые для сборки KDE с поддержкой Wayland; В ОС DragonFly BSD развивается порт с Wayland и Weston, имеется поддержка XWayland; Использующие Wayland пользовательские окружения papyros-shell и Hawaii объединились в новый проект Liri. Liri базируется на Qt 5 (QML) и продвигает оформление в стиле Material Design; Wayland задействован по умолчанию в мобильных платформах Plasma Mobile и Sailfish 2. В панели Cairo-Dock предусмотрена возможность работы в окружении композитного сервера Weston. Для тестирования работы GNOME, KDE и Enlightenment, Hawai и Orbital поверх Wayland выпускается специальный Live-дистрибутив Rebecca Black Linux. Напомним, что Wayland представляет собой протокол взаимодействия композитного сервера и работающих с ним приложений. Клиенты самостоятельно выполняют отрисовку своих окон в отдельном буфере, передавая информацию об обновлениях композитному серверу, который комбинирует содержимое буферов отдельных приложений для формирования итогового вывода с учётом возможных нюансов, таких как перекрытие окон и прозрачность. Иными словами, композитный сервер не предоставляет API для отрисовки отдельных элементов, а оперирует только с уже сформированными окнами, что позволяет избавиться от двойной буферизации при использовании высокоуровневых библиотек, таких как GTK+ и Qt, берущих на себя работу по компоновке содержимого окон. В настоящее время поддержка прямой работы c Wayland уже реализована для библиотек GTK3+, Qt 5, SDL (начиная с выпуска 2.0.2), Clutter и EFL (Enlightenment Foundation Library). Начиная с Qt 5.4 в состав включён модуль QtWayland с реализацией компонентов для работы Qt-приложений в окружении композитного сервера Weston, развиваемого проектом Wayland. Взаимодействие с аппаратным обеспечением в Wayland/Weston, например, проведение инициализации, переключение видеорежимов (drm modesetting) и управление памятью (GEM для i915 и TTM для radeon и nouveau) графических карт, может производиться напрямую через модуль, работающий на уровне ядра, что позволяет обойтись без привилегий суперпользователя. Композитный сервер Weston может работать не только с использованием DRM-модуля ядра Linux, но и поверх X11, другого композитного сервера Wayland, фреймбуфера и RDP. Кроме того, развиваются проекты по обеспечению работы поверх графического стека платформы Android. В рамках проекта Weston развивается одна из реализаций композитного сервера. В роли композитного сервера также может выступать любой другой продукт, поддерживающий протокол Wayland. Например, в настоящее время ведётся работа по обеспечению поддержки Wayland в KWin. В текущем виде Weston уже вышел за рамки набора примеров для тестирования протокола Wayland и может обрастать функциональностью через плагины и дополнения. Пользовательские оболочки и расширенные функций управления окнами предлагается реализовывать в форме внешних бэкендов к Weston. Для обеспечения выполнения обычных X11-приложений в окружении на базе Wayland используется DDX-компонент XWayland (Device-Dependent X), похожий по организации работы на Xwin и Xquartz для платформ Win32 и OS X. Поддержку запуска X11-приложений планируется встроить непосредственно в композитный сервер Weston, который при попытке выполнения X11-приложения будет инициировать запуск X-сервера и связанных с ним компонентов XWayland. При таком подходе процесс запуска X11-приложений будет бесшовным и неотличимым для пользователя от запуска приложений, работающих напрямую с Wayland.