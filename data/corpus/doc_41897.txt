В скрипте инициализации RHEL допущена ошибка, приводящая к удалению всех файлов

В подготовленном для тестового выпуска Red Hat Enterprise Linux 6.7 скрипте инициализации прокси сервера Squid выявлена проблема, которая приводит к удалению всех файлов в системе при перезапуске squid. По своей сути ошибка напоминает недавний инцидент с удалением всех файлов пользователя в клиенте Steam и также приводит к выполнению команды "rm -rf /*" в случае незаполнения формирующей путь переменной. Pavel Šimerda, мэйнтейнер пакета squid из компании Red Hat, смог повторить эксперимент в виртуальной машине с тестовой веткой RHEL 6.7 и установленным пакетом squid-3.1.23-4.el6. Достаточно запустить squid командой "service squid start", после чего инициировать его перезапуск командой "service squid restart", в результате чего начнётся процесс удаления всех файлов на диске. В пакете squid-3.1.23-5.el6 проблема отмечена как решённая (проблемный пакет squid-3.1.23-4.el6 не попал в дистрибутив, ошибка исправлена до публикации). В качестве причины возникновения ошибки упомянуто регрессивное изменение кода. Другая информация пока закрыта для публичного доступа. Судя по всему, проблема вызвана патчем на основе кода, предложенного для контроля за полным завершением ранее работающего экземпляра squid в процессе перезапуска. В альтернативном скрипте инициализации squid.init операция "rm -rf $SQUID_PIDFILE_DIR/*" используется дважды - в блоках stop и restart, при этом в restart удаление выполняется сразу после выполнения блока stop: stop rm -rf $SQUID_PIDFILE_DIR/* start Т.е. при запуске "service squid restart" команда "rm -rf $SQUID_PIDFILE_DIR/*" запускается два раза. Переменная SQUID_PIDFILE_DIR определяется статически в начале файла и, кроме вышеотмеченных команд rm, в дальнейшем используется только в проверке наличия этого пути. Подобная чистка содержимого директории, а также сама переменная SQUID_PIDFILE_DIR, убраны из скрипта инициализации RHEL из-за потенциальных проблем. Патч для решения проблемы с дублированием содержал изменённый вариант функции restart() и был подготовлен на основе неофициального скрипта инициализации, т.е. содержал внутри блока restart типовую строку для чистки ("rm -rf $SQUID_PIDFILE_DIR/*"). С учётом отсутствия переменной SQUID_PIDFILE_DIR в варианте скрипта из состава RHEL 6, подобная чистка приводила к выполнению команды "rm -rf /*".