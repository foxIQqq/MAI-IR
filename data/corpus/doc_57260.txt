В ядро Linux 5.19 принято около 500 тысяч строк кода, связанного с графическими драйверами

В репозиторий, в котором формируется выпуск ядра Linux 5.19, принят очередной набор изменений, связанных с подсистемой DRM (Direct Rendering Manager) и графическими драйверами. Принятый набор патчей интересен тем, что включает 495 тысяч строк кода, что сопоставимо с общим размером изменений в каждой ветке ядра (например, в ядре 5.17 было добавлено 506 тысяч строк кода). Около 400 тысяч добавленных строк приходится на автоматически сгенерированные заголовочные файлы с данными для регистров ASIC в драйвере для GPU AMD. Ещё 22.5 тысяч строк обеспечивают начальную реализацию поддержки AMD SoC21. Общий размер драйвера для GPU AMD превысил 4 млн строк кода (для сравнения, всё ядро Linux 1.0 включало 176 тысяч строк кода, 2.0 - 778 тысяч, 2.4 - 3.4 млн., 5.13 - 29.2 млн). Кроме SoC21 в драйвере AMD включена поддержка SMU 13.x (System Management Unit), обновлена поддержка USB-C и GPUVM, проведена подготовка к поддержке следующих поколений платформ RDNA3 (RX 7000) и CDNA (AMD Instinct). В драйвере Intel наибольшее число изменений (5.6 тысяч) присутствует в коде для управления энергопотреблением. Также в драйвер Intel добавлены идентификаторы GPU Intel DG2 (Arc Alchemist), используемых на ноутбуках, обеспечена начальная поддержка платформы Intel Raptor Lake-P (RPL-P), добавлена информация о графических картах Arctic Sound-M), реализован ABI для вычислительных движков, для карт DG2 добавлена поддержка формата Tile4, для систем на базе микроархитектуры Haswell реализована поддержка DisplayPort HDR. В драйвере Nouveau в сумме изменения затронули около сотни строк кода (осуществлён переход на использование обработчика drm_gem_plane_helper_prepare_fb, для некоторых структур и переменных применено статическое выделение памяти). Что касается использования в Nouveau открытых компанией NVIDIA исходных текстов модулей ядра, то работа пока сводится к выявлению и устранению ошибок. В дальнейшем опубликованную прошивку планируется использовать для повышения производительности драйвера.