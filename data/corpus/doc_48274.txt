Выпуск HTTP-акселератора Varnish 6.0

Пол-Хенинг Камп (Poul-Henning Kamp), один из известных разработчиков FreeBSD, участвовавший в создании таких систем, как MD5crypt, GEOM, GBDE и FreeBSD Jail, представил релиз Varnish 6.0, высокопроизводительного кэширующего прокси, предназначенного для работы в роли HTTP-акселератора. Проект распространяется под лицензией BSD и используется в проектах Facebook, Wikimedia, Twitter, Vimeo, Tumblr, New York Times и Guardian. Благодаря применению многопоточности и современных методов мультиплексирования соединений, таких как epoll и kqueue, а также системных вызовов sendfile и madvise, Varnish демонстрирует отличную производительность, например, на обычном оборудовании способен обработать поток в 20 Gbps и обеспечить ускорение отдачи запросов в 300-1000 раз. Кэш хранится в виртуальной памяти. Особенностью Varnish является способность собирать отдаваемые страницы по частям на стороне фронтэнда, определяя логику сборки на языке ESI (Edge Side Includes). Varnish также предоставляет очень гибкую систему конфигурации, в которой допускается использование вставок на языке Си. Для конфигурации используется специальный язык VCL, который затем компилируется в исполняемый бинарный код. VCL позволяет описать политику обработки запроса: определить обрабатываемый контент, откуда его получить и как преобразовать перед отдачей. Базовая функциональность может расширяться через модули. Присутствуют механизмы балансировки нагрузки, учета состояния и времени реакции бэкенд-серверов. Основные новшества: Поддержка подключения клиентов и серверов бэкендов через Unix Domain Socket; Расширение поддержки протокола HTTP/2 и доведения её до готовности к промышленному применению; Новый модуль vmod_directors с реализацией различных методов балансировки нагрузки между бэкендами; Новый модуль vmod_proxy для извлечения атрибутов TLV, используя proxy-protocol-v2; Новый модуль vmod_unix для получения информации о пользователе и группе, под которыми работает процесс, подключившийся через Unix Domain Socket; Новый модуль vmod_vtc с инструментами для написания тестов для проверки различных пограничных ситуаций.