Утечка поисковых ключей через DNS в Firefox и Chrome

В Firefox и Chrome выявлена особенность обработки набранных в адресной строке поисковых запросов, которая приводит к утечке сведений через DNS-сервер провайдера. Суть проблемы в том, что если поисковый запрос состоит только из одного слова, браузер вначале пытается в DNS определить наличие хоста с таким именем, полагая, что пользователь пытается открыть поддомен, и уже потом перенаправляет запрос поисковой системе. Таким образом, владелец DNS-сервера, указанного в настройках пользователя, получает сведения о состоящих из одного слова поисковых запросах, что оценивается как нарушение конфиденциальности. Проблема проявляется при использовании как DNS-сервера провайдера, так и сервисов "DNS over HTTPS" (DoH), в случае задания в настройках DNS-суффикса (устанавливается по умолчанию при получении параметров по DHCP). При этом, главная проблема в том, что даже при включении DoH, запросы продолжают отправляться через указанный в системе DNS-сервер провайдера. Важно, что попытка резолвинга осуществляется только при отправке поисковых запросов, состоящих из одного слова. При указании нескольких слов обращение к DNS не производится. Проблема подтверждена в Firefox и Chrome, а также возможно затрагивает и другие браузеры. Разработчики Firefox согласились с наличием проблемы и намерены предоставить решение в выпуске Firefox 79. В частности, для управления поведением при обработке поисковых запросов в about:config добавлена настройка "browser.urlbar.dnsResolveSingleWordsAfterSearch", при установке которой в значение "0" резолвинг блокируется , "1" (по умолчанию) используется эвристика для выборочного резолвинга и "2" сохраняется старое поведение. Эвристика заключается в проверке включения DoH, наличия только записи о 'localhost' в /etc/hosts и отсутствия поддомена для текущего хоста. Разработчики Chrome пообещали ограничить утечку через DNS, но сообщение о похожей проблеме остаётся нерешённым с 2015 года. В Tor Browser проблема не проявляется.