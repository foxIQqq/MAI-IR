Mozilla анонсировал проект mozjpeg, нацеленный на сокращение размера JPEG-изображений в Web

Проект Mozilla представил первый выпуск проекта mozjpeg, нацеленного на создание готового для промышленного применения высококачественного кодировщика JPEG-изображений, демонстрирующего более высокую степень сжатия при сохранении совместимости с подавляющим большинством существующих декодировщиков JPEG. Mozjpeg продолжает развитие библиотеки libjpeg-turbo и является форком данного проекта (libjpeg-turbo был ответвлён от libjpeg для оптимизации скорости кодирования и декодирования, а mozjpeg ответвлён от libjpeg-turbo для оптимизации размера). Код библиотеки распространяется под лицензией BSD. В настоящее время актуальной является проблема увеличение размера сайтов в Web, существенное влияние на который оказывает активное размещение фотографий. Для того чтобы сократить трафик компания Google пытается продвинуть формат WebP, отличающийся более эффективным кодированием, но пока не получившим повсеместное распространение. Разработчики Mozilla решили пойти иначе и занялись оптимизацией методов кодирования JPEG без нарушения совместимости с декодировщиками. Проанализировав применяемые ныне кодировщики JPEG, был сделан вывод, что не все возможные пути сокращения размера используются и эффективность кодирования JPEG можно заметно улучшить без потери совместимости. Первый выпуск mozjpeg примечателен добавлением функциональности "jpgcrush", основанной на алгоритме из одноимённой утилиты, изначально написанной на языке Perl и позволяющей успешно сокращать размер JPEG-файлов без потери качества. В среднем jpgcrush позволяет при полном сохранении качества сократить размер JPEG-файла на 2-6% для изображений перекодированных из PNG в JPEG при помощи оригинальной библиотеки libjpeg. При тестировании выборки из 1500 JPEG-файлов, размещённых на Wikimedia, в среднем их размер был уменьшен на 10%. Сокращение размера достигается за счёт выявления оптимальной прогрессивной конфигурации кодирования, которая использует меньший объём данных. До сих пор в кодировщиках не применялась подобная техника, поэтому решено использовать jpgcrush в качестве первой новой возможности 'mozjpeg'. Следующим шагом станет улучшение кодирования через применения техники адаптивного треллис-квантования (trellis quantization), уже используемого в видео-кодеках Theora, Xvid и x264. Суть метода сводится к выбору такого набора уровней в блоке трансформации, который минимизирует метрики размер/искажения, подбирая параметры для которых удаётся добиться минимального размера при сохранении качества. Библиотека mozjpeg полностью совместима с библиотекой libjpeg-turbo и использует аналогичный набор параметров, что позволяет использовать mozjpeg в качестве прозрачной замены libjpeg-turbo. Для новых возможностей mozjpeg добавлены новые опции, но они для сохранения совместимости не включены по умолчанию. Тем не менее, данные опции включены в поставляемой в комплекте утилите cjpeg, при использовании которой применяется наиболее агрессивный набор оптимизаций для сокращения размера результирующих файлов.