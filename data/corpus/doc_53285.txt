В Firefox добавлено ускорение декодирования видео через VA-API для систем X11

В кодовую базу Firefox, на основе которой 25 августа будет сформирован релиз Firefox 80, добавлено изменение, отключающее для Linux привязку поддержки аппаратного ускорения декодирования видео к системам на базе Wayland. Ускорение обеспечивается при помощи VA-API (Video Acceleration API) и FFmpegDataDecoder. Таким образом, поддержка аппаратного ускорения видео через VA-API станет доступна и для Linux-систем, использующих протокол X11. Ранее стабильное аппаратное ускорение видео обеспечивалось только для нового бэкенда, использующего Wayland и механизм DMABUF. Для X11 ускорение не применялось из-за проблем с gfx-драйверами. Теперь проблема с задействованием ускорения видео для X11 решена через использование EGL. Также для систем с X11 реализована возможность работы WebGL через EGL, которая в будущем позволит включить для X11 и поддержку аппаратного ускорения WebGL. В настоящее время данная возможность пока остаётся отключённой по умолчанию (включается через widget.dmabuf-webgl.enabled), так как не все проблемы пока решены. Для активации работы через EGL предусмотрена переменная окружения MOZ_X11_EGL, после установки которой Webrender и компоненты композитинга OpenGL переключаются на использование EGL вместо GLX. Реализация основана на новом бэкенде для X11 на базе DMABUF, который подготовлен путём разделения DMABUF-бэкенда, ранее предложенного для Wayland. Дополнительно можно отметить включение в кодовую базу, на основе которой формируется выпуск Firefox 79, системы композитинга WebRender для ноутбуков на базе чипов AMD на платформе Windows 10. WebRender написан на языке Rust и позволяет добиться существенного увеличения скорости отрисовки и снижения нагрузки на CPU за счёт выноса на сторону GPU операций отрисовки содержимого страницы, которые реализованы через выполняемые в GPU шейдеры. Ранее WebRender был включён на платформе Windows 10 для GPU Intel, APU AMD Raven Ridge, AMD Evergreen и на ноутбуках с видеокартами NVIDIA. В Linux WebRender пока активируется для карт Intel и AMD только в ночных сборках, и не поддерживается для карт NVIDIA. Для принудительного включения в about:config следует активировать настройки "gfx.webrender.all" и "gfx.webrender.enabled" или запустить Firefox с выставленной переменной окружения MOZ_WEBRENDER=1. В Firefox 79 также по умолчанию добавлена настройка для включения динамической изоляции Cookie по отображаемому в адресной строке домену ("Dynamic First Party Isolation", когда свои и сторонние вставки определяются на основе базового домена сайта). Настройка предложена в конфигураторе в секции настройки блокировки отслеживания перемещений в выпадающем блоке методов блокировки Cookie. Также в Firefox 79 активирован по умолчанию новый экран с экспериментальными настройками - "about:preferences#experimental", предоставляющий интерфейс для включения экспериментальных возможностей, похожий на about:flags в Chrome.