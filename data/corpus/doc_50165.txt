Проект Hangover для запуска Windows-приложений на системах ARM64 c Linux и Android

Разработчики проекта Wine опубликовали первый публичный выпуск эмулятора Hangover, позволяющего запускать 32- и 64-разрядные Windows-приложения, собранные для архитектур x86 и x86_64, в окружениях Linux и Android на базе архитектуры ARM64 (Aarch64). Выпуск основан на кодовой базе Wine 4.0, что отражено в номере версии Hangover 0.4.0. Слой эмуляции базируется на наработках проекта QEMU. В отличие от запуска Wine с минимальным системным окружением при помощи QEMU в режиме эмуляции на уровне системных вызовов (используется одно ядро с основной системой), проект Hangover позволяет добиться существенно более высокой производительности. Ускорение достигается за счёт переноса слоя эмуляции на уровень API Win32/Win64, вместо эмуляции штатных системных вызовов с последующей эмуляцией на их основе API Win32/Win64. В настоящее время проект позволяет запускать лишь простые приложения и игры, использующие API Win64 и Win32. Для Linux реализована поддержка Direct3D, которая пока отсутствует для Android из-за неполной поддержки OpenGL ES в Wine. Для обеспечения работы используется штатная установка Wine, дополненная рядом DLL-библиотек и прослоек. В окружении Linux приложения Windows запускаются автоматически при наличии qemu в каталоге Wine ("C:\x86\qemu-x86_64.exe.so"). В Android для запуска предлагается использовать утилиту cmd. Производительность Hangover пока оставляет желать лучшего. Основным узким местом является производительность кода, который генерирует QEMU. Тем не менее при запуске на устройстве Nvidia Shield Android TV производительности достаточно для выполнения игр начала двухтысячных годов. Среди протестированных в Hangover приложений отмечаются Notepad++, ANNO 1602, Age of Wonders, Warhammer 40k: Dawn of War, The Settlers II 10th Anniversary, Prince of Persia 3D, Worms 2 и Worms Armageddon. Примеры из DirectX 9 SDK также выполняется с приемлемой скоростью. Что касается запуска 32-разрядных Windows-приложений (x86), их обработка производится на уровне трансляции структур, передаваемых между приложением и Wine (модель LLP64 в Windows подразумевает сохранение базовой совместимости структур между 32- и 64-разрядными WinAPI). Для запуска 32-разрядных Windows приложений используются 64-разрядные сборки Wine и каждый процесс перед обрабатывается как 64-разрядный. На стороне хост-систем пока поддерживаются только архитектуры ARM64 и x86_64, но код унифицирован, что позволяет без больших трудозатрат портировать проект и под другие архитектуры c порядком следования байт от младшего к старшему (little-endian).