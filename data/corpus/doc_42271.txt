Уязвимость в драйвере KCodes NetUSB ставит под удар миллионы домашних маршрутизаторов

В развиваемом компанией KCodes драйвере NetUSB выявлена критическая уязвимость (CVE-2015-3036), позволяющая выполнить свой код с правами ядра через отправку специально оформленного сетевого пакета. Атака может быть совершена злоумышленником, имеющим доступ к локальной сети, в которой размещён маршрутизатор. NetUSB представляет собой модуль для ядра Linux, обеспечивающий возможность проброса USB-устройства по сети и предоставления к нему совместного доступа. Драйвер NetUSB достаточно широко распространён в маршрутизаторах и точках доступа для домашних и небольших офисных сетей, в том числе он используется в различных моделях устройств Netgear, D-Link, TP-Link, Trendnet и Zyxel. Кроме того, отмечается, что продукты ещё 21 производителя, поддержка которых явно присутствует в драйвере, потенциально могут быть подвержены уязвимости, но они ещё не проверены на наличие проблемы. Уязвимость вызвана классическим переполнением буфера, возникающим при копировании передаваемого со стороны пользователя имени клиентской системы без проверки соответствия размера строки, помещаемой в буфер фиксированного размера (64 байта). Так как выпуск обновления прошивки у многих производителей может затянуться, для защиты рекомендуется убедиться, что в настройках отключена функция совместного доступа к USB-устройствам (в разных устройствах драйвер может активироваться по разному, например, через опции ReadySHARE, "Print sharing" или "USB share port"). В некоторых моделях драйвер всегда активен и может быть ограничен только блокировкой TCP-порта 20005. Несмотря на то, что сетевой порт NetUSB, как правило, открывается только для локальной сети, при сканировании интернета выявлены устройства, в которых соединения NetUSB принимаются из глобальной сети. Для демонстрации успешного совершения атаки уже подготовлен прототип эксплоита, который решено некоторое время не публиковать, дав возможность производителям выпустить обновления прошивок. Интересно, что попытка добиться исправления проблемы предпринималась с февраля, но прямое общение с производителями затянулось и не привело к каким-то результатам, несмотря на предоставление рабочего эксплоита. Проблема была признана и работа над исправлением активировалась только после привлечения в качестве посредника организации CERT/CC. При этом, в настоящий момент только компания TP-LINK подготовила исправления и опубликовала план выпуска обновлений прошивок для его доведения до пользователей.