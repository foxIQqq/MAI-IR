Уязвимость в TCP-стеке FreeBSD, позволяющая обрывать чужие TCP-соединения

Во всех поддерживаемых ветках FreeBSD выявлена уязвимость (CVE-2004-0230), позволяющая сторонним атакующим, способным выполнить спуфинг IP-трафика и знающим номера портов двух сторон соединения, сбрасывать установленные TCP-соединения через отправку двух специально оформленных пакетов. В случае, если номер порта клиентской стороны неизвестен, для успешного проведения атаки требуется отправить менее 2^17 поддельных пакетов, что может быть сделано менее чем за секунду при наличии высокоскоростного доступа в сеть. Уязвимость вызвана недоработкой в TCP-стеке, из-за которой при поступлении сегмента с SYN-флагом для уже установленного соединения производилось завершение данного соединения, без выполнения проверки корректности указанного в пакете номера последовательности (Sequence Number), идентифицирующей соединение. Т.е. соединение можно сбросить отправив пакет с указанием фиктивного IP-адреса, без необходимости подбора Sequence Number. Проблема устранена в свежих обновлениях, выпущенных для веток FreeBSD 8.x, 9.x и 10.x. Кроме применения патча в качестве мер защиты могут быть применены традиционные методы борьбы со спуфингом на стороне маршрутизатора или активировано отслеживание корректности сеансов на стороне межсетевого экрана (stateful traffic inspection), например, силами PF (достаточно использовать набор правил по умолчанию). Интересно, что аналогичная уязвимость была исправлена в NetBSD ещё 10 лет назад.