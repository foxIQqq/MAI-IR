Microsoft портировал подсистему WSL2 (Windows Subsystem for Linux) в Windows 10 1903 и 1909

Компания Microsoft объявила о предоставлении поддержки подсистемы WSL2 (Windows Subsystem for Linux) в выпусках Windows 10 - 1903 и 1909, сформированных в мае и ноябре прошлого года. Изначально подсистема WSL2, обеспечивающая запуск исполняемых файлов Linux в Windows, была предложена в выпуске Windows 10 2004. Теперь Microsoft перенёс данную подсистему в прошлые обновления Windows 10, которые остаются актуальными и используются на многих предприятиях. Портирование в данные выпуски WSL2 позволит организовать эффективное выполнение Linux-окружения без необходимости перехода на Windows 10 2004 (сопровождение выпусков 1903 и 1909 продлится до декабря 2020 года и мая 2022 года). Напомним, что редакция WSL2 отличается поставкой полноценного ядра Linux вместо ранее применяемого эмулятора, выполнявшего трансляцию системных вызовов Linux в системные вызовы Windows. Ядро Linux в WSL2 не входит в установочный образ Windows, а загружается динамически и поддерживаться в актуальном виде силами Windows по аналогии с тем, как устанавливаются и обновляются графические драйверы. Для установки и обновления ядра применяется штатный механизм Windows Update. Предлагаемое для WSL2 ядро основано на выпуске ядра Linux 4.19, который выполняется в окружении Windows при помощи виртуальной машины, уже задействованной в Azure. Применяемые в ядре специфичные для WSL2 патчи включают оптимизации для сокращения времени запуска ядра, уменьшения потребления памяти, возвращения Windows освобождённой Linux-процессами памяти, оставления в ядре минимально необходимого набора драйверов и подсистем. Окружение WSL2 выполняется в отдельном дисковом образе (VHD) c файловой системой ext4 и виртуальным сетевым адаптером. Как и в WSL1 компоненты пространства пользователя устанавливаются отдельно и базируются на сборках различных дистрибутивов. Например, для установки в WSL в каталоге Microsoft Store предлагаются сборки Ubuntu, Debian GNU/Linux, Kali Linux, Fedora, Alpine, SUSE и openSUSE. Компания Canonical уже объявила о готовности установочных сборок Ubuntu 20.04 LTS, протестированных в окружениях WSL2 на базе Windows 10 1903 и 1909. Для включения WSL2 в Windows 10 1909 необходимо установить обновление kb4571748 и выполнить в PowerShell с правами администратора команду: Enable-WindowsOptionalFeature -Online -FeatureName VirtualMachinePlatform -NoRestart Далее нужно перезапустить компьютер и активировать WSL2 по умолчанию: wsl.exe --set-default-version 2 После этого можно установить желаемое Linux-окружение из каталога Microsoft Store или преобразовать уже имеющееся окружения в формате WSL 1 при помощи команды "wsl.exe --set-version Ubuntu 2". Дополнительно можно упомянуть об адаптации окружения Docker Desktop для использования WSL2 вместо бэкенда на основе HyperV. Применение WSL2 позволит запускать Docker Desktop не только обладателям Windows Pro и Windows Enterprise, но и пользователям Windows Home.