Статус разработки новшеств и поддержки Wayland в KDE Plasma 5

Мартин Грэсслин (Martin Gräßlin), ведущий разработчик оконного менеджера KWin, рассказал о текущем состоянии портирования KDE 5 для работы с Wayland. Некоторые из описанных улучшений уже вошли в состав на днях представленного релиза KDE Frameworks 5.15.0. Основные достижения: Для KWin подготовлен виртуальный бэкенд, не привязанный к системам вывода и симулирующий отрисовку. Подобный бэкенд можно рассматривать как виртуальный сервер Wayland, реализованный на общей кодовой базе ("kwin_wayland --virtual") и полностью аналогичный обычному серверу Wayland. Прежде всего новый бэкенд интересен с позиции расширения возможностей по автоматизированному тестированию и организации тестирования полноценного сеанса Plasma в системе непрерывной интеграции, с созданием скриншотов для каждой стадии тестирования. Кроме того, виртуальный бэкенд может быть использован в качестве основы для адаптации KWin для работы с новыми системами вывода, такими как запуск в облачных окружениях с трансляцией вывода в окно браузера или организация доступа через VNC/rdesktop/spice. Решены проблемы с закреплением позиции отображения меню (позиция открытия меню в окне не была постоянной); Для использования с Wayland адаптированы некоторые специфичные расширения Plasma, ранее привязанные к API X11, такие как эффекты раздвижения всплывающих окон, размытие и изменение контрастности фона. Подобные расширения теперь абстрагированы от графической подсистемы и реализованы в форме плагинов к KWindowSystem, что позволяет использовать их как с X11, так и с Wayland. Поддержка данных расширений добавлена в Wayland-сервер KWayland, а плагины для привязки с KWindowSystem добавлены в репозиторий kwayland-integration; В KWindowSystem реализован API, позволяющий организовать взаимодействие приложения сразу с несколькими X-серверами. С практической стороны изменение позволяет организовать работу вложенных графических сеансов, в которых осуществляется запуск kwin_wayland в окружении на базе X11. В этом случае требуется обращение к двум X-серверам - базовому X-серверу через который выполняется отрисовка и специализированному Xwayland для обеспечения запуска X-программ внутри Wayland-окружения. Из-за отсутствия поддержки обращения к нескольким X-сервера в выпуске Plasma 5.4 пиктограммы окна вложенного сеанса размещались вне заголовка, теперь эта особенность устранена, а также добавлен новый режим захвата ввода для вложенного сеанса, работающий по аналогии с захватом ввода для виртуальных машин. Кроме того, Кай Уве (Kai Uwe), вовлечённый в разработку KDE Plasma и редакции KDE для мобильных систем, опубликовал обзор новшеств, развиваемых в рамках ветки KDE Plasma 5.5: Новая реализация интерфейса переключения между пользователями, не привязанная к KRunner, объединённая с интерфейсом выбора пользователя на экране блокировки систем и показывающая полное имя и аватар пользователя. Разработан плазмоид для переключения между пользователями из панели на рабочем столе, аналогичный доступному для KDE 4 плазмоиду Fast User Switch; Новый плазмоид Color Picker для определения параметров цвета произвольных элементов на экране и помещения их в буфер обмена в различных форматах (RGB, Hex, Qt QML rgba, LaTeX). Color Picker пришёл на смену Kolourpicker, доступному в KDE 4; Возвращена система автоматического монтирования устройств (Solid Device Auto Mounter), позволяющая настроить автоматическое подключение устройств хранения во время входа в систему или присоединения устройства к компьютеру; Расширена функциональность пиктограммы, отображаемой при переносе файла или приложения на рабочий стол. В частности, добавлена возможность обработки события перетаскивания на пиктограмму других файлов, например, для запуска программы с открытием данного файла. Реализована возможность перемещения окна между виртуальными рабочими столами путём перетаскивания его на эскиз виртуального рабочего стола на панели задач. Контекстные меню больше не перекрывают панель и выводятся рядом с местом клика; В системный лоток возвращена страница настройки ярлыков для апплетов.