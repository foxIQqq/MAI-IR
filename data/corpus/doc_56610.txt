Уязвимость в механизме ucount ядра Linux, позволяющая повысить свои привилегии

В ядре Linux в коде обработки ограничений rlimit в разных пространствах имён идентификаторов пользователей (user namespaces) выявлена уязвимость (CVE-2022-24122), позволяющая повысить свои привилегии в системе. Проблема проявляется начиная с ядра Linux 5.14 и будет устранена в обновлениях 5.16.5 и 5.15.19. Стабильные ветки Debian, Ubuntu, SUSE/openSUSE и RHEL проблема не затрагивает, но проявляется в свежих ядрах Fedora и Arch Linux. Ошибка внесена в добавленном летом 2021 года изменении, переводящем реализацию некоторых счётчиков RLIMIT на использование структуры "ucounts". Созданные для RLIMIT объекты "ucounts" продолжали использоваться после освобождения выделенной для них памяти (use-after-free) при удалении связанного с ними пространства имён, что позволяло добиться выполнения своего кода на уровне ядра. Эксплуатация уязвимости непривилегированным пользователем возможна только при включении в системе непривилегированного доступа к пространству имён идентификаторов пользователей (unprivileged user namespace), который включён по умолчанию в Ubuntu и Fedora, но не активирован в Debian и RHEL. В качестве обходного пути для блокирования уязвимости можно отключить непривилегированный доступ к user namespace: sysctl -w kernel.unprivileged_userns_clone=0