В ядро NetBSD добавлена поддержка расширений на языке Lua

В состав ядра текущей экспериментальной ветки NetBSD, на базе которой формируется выпуск NetBSD 7, включен модуль с реализацией виртуальной машины Lua, добавляющий в ядро поддержку встраиваемого скриптового языка программирования, отличающегося эффективной работой с памятью, компактностью и высокой производительностью (применяется JIT-компиляция). Поддержка Lua в ядре позволит разрабатывать динамически загружаемые расширения, изменяющие поведение существующих систем или создающие новые возможности. Использование расширений на языке Lua оправдано в ситуациях, когда важна скорость создания готового решения и не требуется высокая производительность. Например, модуль будет полезен при необходимости быстро реализовать нужную функциональность, опробовать на практике запланированные к реализации идеи или подготовить скрипты для отладки подсистем ядра. В качестве примеров расширений упоминаются скрипты для опробования разных алгоритмов работы планировщика задач, механизмов QoS, создание расширенных обработчиков сетевых пакетов и изощрённых сетевых фильтров, определение собственных правил управления энергопотреблением процессора, создание прототипов драйверов устройств. Как и в случае запуска скриптов в пространстве пользователя, разработчик получает возможность запускать скрипт в пространстве ядра, оценивать результат его работы, быстро вносить изменения и повторно запускать скрипт, не тратя время на перекомпиляцию. Выполняемые в пространстве ядра скрипты не имеют прямого доступа к памяти ядра, изолированы в отдельной виртуальной машине Lua и взаимодействуют с подсистемами ядра через специальные биндинги. На стадии формирования байткода выполняется выявление и блокирование опасных конструкций, таких как бесконечное зацикливание. Для запуска скриптов в пространстве ядра из окружения пользователя подготовлена специальная утилита luactl.