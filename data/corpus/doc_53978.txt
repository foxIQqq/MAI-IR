Релиз FreeBSD 12.2

Представлен релиз FreeBSD 12.2, который опубликован для архитектур amd64, i386, powerpc, powerpc64, powerpcspe, sparc64 и armv6, armv7 и aarch64. Дополнительно подготовлены образы для систем виртуализации (QCOW2, VHD, VMDK, raw) и облачных окружений Amazon EC2. Релиз FreeBSD 13 запланирован на 23 марта 2021 года. Ключевые новшества: Обновлены беспроводной стек, драйверы для беспроводных устройств и компоненты hostapd и wpa_supplicant, в которых включена поддержка 802.11n, 802.11w, 802.11ac и 802.11ax (Wi-Fi 6). Добавлен драйвер ice с поддержкой 100-гигабитных Ethernet-адаптеров Intel. Задействована техника защиты W^X (write XOR execute), подразумевающая, что страницы памяти не могут быть одновременно доступны на запись и исполнение. Режим W^X позволит загружать ядро с применением исполняемых страниц памяти, для которых запрещена запись (ранее для страниц памяти с данными ядра уже применялся запрет исполнения, но без привязки к возможности записи). DRM-драйверы (Direct Rendering Manager) в графической подсистеме синхронизированы с ядром Linux 5.4. Файлы DTS (Device Tree Sources) синхронизированы с ядром Linux 5.6. Проведена работа по использованию udev/evdev и libinput для повышения совместимости с устройствами ввода, для которых теперь не требуются локальные настройки. В инфраструктуре эмуляции окружения Linux (Linuxulator) внесены изменения для решения проблем с функционированием конкретных Linux-приложений (например, Chromium, Firefox, DB2, Oracle, EAGLE, Memcached, Nginx, Steam, signal-desktop, VLC, 1password). Объявляемая эмулятором версия ядра Linux повышена до 3.10.0 (как в RHEL 7), налажена работа вызова gettynam в chroot, улучшена поддержка memfd, добавлены системные вызовы splice и sendfile, реализован ioctl BLKPBSZGET, предоставлена поддержка kcov. Добавлены sysctl compat.linux.use_emul_path и compat.linux.debug. Переделана обработка ошибок. Добавлен режим TCP_CORK (требуется для nginx). Реализован флаг MAP_32BIT (решает проблему с запуском пакетов с Mono. В утилиту jail добавлена возможность запуска Linux в jail-окружениях. В rc.conf добавлена переменная "linux_mounts_enable", отвечающая за монтирование специфичных для Linux файловых систем в иерархию "/compat/linux" при включении эмуляции Linux (linux_enable=YES). В утилиту cron добавлена поддержка новых флагов в crontab: "-n" и "-q" для отключения отправки писем при запуске задания и отключения записи в лог информации о выполненных командах. В утилите dd реализованы новые операции conv=fsync, conf=fdatasync, oflag=fsync, oflag=sync и iflag=fullblock. Улучшена работа утилиты fsck_msdosfs, в том числе сокращено потребление памяти и добавлен флаг "-M" для отключения использования mmap. Добавлена утилита certctl для управления сертификатами и чёрными списками отозванных сертификатов. В syslogd реализована возможность фильтрации атрибутов (текст сообщения, программа, хост и т.п.) при помощи масок и регулярных выражений. В утилите sed добавлена возможность чтения команд из стандартного потока при указании опции "-f -". В sesutil добавлена команда "show" для вывода сводки о SES-контроллере (SCSI Enclosure Services). В утилите bhyve добавлена возможность настройки дополнительных параметров контроллера AHCI. Утилита amd помечена как устаревшая и будет удалена во FreeBSD 13.0. Для автоматического монтирования ФС рекомендовано использовать autofs или порт sysutils/am-utils. В библиотеку libifconfig добавлена возможность предоставления информации о состоянии сетевых мостов (bridge). В ядре изменено поведение системного вызова read, который теперь по умолчанию неприменим к каталогам. Для возвращения старого поведения предложен sysctl security.bsd.allow_read_dir. Добавлена поддержка интерфейса APEI (ACPI Platform Error Interfaces), через который чипсет передаёт операционной системе сведения об аппаратных ошибках, например, ошибках PCIe при подключении оборудования. В драйвер virtio_blk добавлена поддержка операции TRIM (информирование об освобождении блоков). В ZFS добавлена возможность вывода статистики (kstat) об операциях записи и чтения с разделением по dataset-ам. В загрузчике реализована возможность переключения между разными устройствами для консоли (Serial, Video). В устройства tap и tun добавлена возможность создания псевдонимов для общего управляющего интерфейса в /dev. В библиотеку libalias и пакетный фильтр ipfw добавлена поддержка подсетей CGN (Carrier Grade NAT, RFC 6598). В драйвере ng_nat появилась возможность прикрепления к ethernet-интерфейсу. Обновлены драйверы устройств. Драйвер ixl (Intel Ethernet 700) обновлён до версии 1.11.29, ena (Amazon Elastic Network Adapter) до версии 2.2.0, а cxgbe (Chelsio T4, T5, T6 Ethernet) до версии 1.25.0.0. Помечены устаревшими и будут удалены во FreeBSD 13.0 драйверы ubsec (криптоакселераторы Broadcom и BlueSteel uBsec 5x0x), ufm (Cypress Semiconductor FM Radio), apm (apm BIOS), ctau (Cronyx Tau) и cx (Cronyx Sigma). Из ядра GENERIC для 32-разрядных систем удалён драйвер mps (LSI Fusion-MPT 2 IT/IR 6Gb/s Serial Attached SCSI/SATA). Сlang, llvm, lld, lldb, compiler-rt и libc++ обновлены до версии 10.0.1 (в прошлом выпуске поставлялся LLVM 8). Обновлены версии pkg 1.15.10, tcsh 6.21.00, less 551, libbsdxml 2.2.9, resolvconf 3.9.2, pcap 1.9.1, tcpdump 4.9.3, xz 5.2.5, OpenSSH 7.9p1, unbound 1.10.1, libarchive 3.4.3, svn 1.14.0, ntpd 4.2.8p15, file 5.39, bc 3.1.1, sqlite3 3.32.3, BSD make 20200719, Sendmail 8.16.1, OpenSSL 1.1.1h. Начиная с FreeBSD 13.0 тип CPU (CPUTYPE) для архитектуры i386 по умолчанию будет изменён с 486 на 686 (при желании сборки для i486 и i586 можно сформировать самостоятельно).