Опасная уязвимость в реализациях LZO/LZ4, затрагивающая ядро Linux, FFmpeg, OpenVPN и другие проекты

В различных реализациях алгоритмов распаковки LZO и LZ4 выявлена опасная уязвимость (CVE-2014-4607), которая присутствует уже около 20 лет и может привести к повреждению областей памяти при распаковке специально оформленных сжатых данных. Проблема вызвана целочисленным переполнением, проявляющимся при обработке больших непрерывных блоков нулевых байтов (более 16Мб). В настоящее время обозначена возможность применения уязвимости в LZO для совершения DoS-атак и теоретически для организации выполнения кода злоумышленника. При использовании LZO в многопоточных программах уязвимость может привести к повреждению структур, влияющих на процесс выполнения, что может быть использовано для получения контроля за выполнением нитей или процессов из другого контекста. Особенность работы алгоритма LZ4 делает возможность организации выполнения кода более реалистичной, так как в результате атаки можно изменить указатель по заданному смещению и переписать часть структур, влияющих на выполнение кода. Проблему усугубляет то, что, в силу специфики использования LZO/LZ4, уязвимость во многих случаях может быть эксплуатирована удалённо. Кроме того, быстрые и эффективные алгоритмы LZO/LZ4 очень широко используются в программном обеспечении: от ядра Linux, Juniper Junos, MPlayer2, Libav, FFmpeg и OpenVPN до различных встраиваемых платформ и устройств, в том числе автомобильных систем и даже марсохода Curiosity. Поддержка сжатия с использованием LZO применяется во многих файловых системах, включая btrfs, squashfs, jffs2 и ubifs. LZ4 применяется в файловой системе ZFS. Уязвимоcти подвержены все версии пакетов lzo1, lz4 и liblzo2 (за исключением платформ, на которых при сборке используются макросы LZO_UNALIGNED_OK_8 и LZO_UNALIGNED_OK_4), а также многие сторонние реализации LZO и LZ4, входящие в состав различных библиотек и продуктов. Проявление уязвимости протестировано на архитектурах x86_64, i386 и ARM. Проблема уже исправлена в выпусках ядра Linux 3.15.2, 3.14.9, 3.4.95 и 3.10.45. В дистрибутивах обновления пока на стадии подготовки. Оценить появление обновлений можно на следующих страницах: Debian, Ubuntu, CentOS, RHEL, Fedora, openSUSE, SLES, Slackware, Gentoo, OpenBSD, NetBSD, FreeBSD.