Особенности архитектуры digg.com

Представлен обзор особенностей архитектуры digg.com, составленный на основе выступления главного архитектора Digg на конференции Web 2.0 Expo. digg.com входит в 100 самых посещаемых ресурсов сети, обслуживая в пиках до 27 тыс. запросов в секунду. Используется Debian Linux, MySQL, Apache2, FastCGI и PHP. Для кеширования задействован Memcached, для оптимизации производительности скриптов - APC PHP Accelerator; Главное узкое место - ввод/вывод, производительности PHP скриптов вполне хватает. Данные хранятся в децентрализованном виде, причем в дополнение к типичному горизонтальному масштабированию разделения данных по машинам (наборы записей по определенному признаку распределены по серверам), задействована методика вертикального масштабирования хранения данных, при которой практикуется разделение столбцов по разным таблицам. Например, при появлении необходимости добавления дополнительных столбцов, они создаются в новой таблице, не требуя реструктуризации базы. Данные распределены по нескольким кластерам: действия пользователей, база аккаунтов, комментарии и т.п. Разрозненность хранения скрыта за единым API, манипуляции с СУБД максимально упрощены, все что можно вынесено на плечи PHP скриптов. Для оптимизации операций чтения данных используется репликация MySQL; Широко используются асинхронные очереди операций. Для формирования блока данных запросы к разным СУБД производятся в параллельном режиме; Для хранения пиктограмм и фотографий задействована распределенная файловая система MogileFS; Многоуровневая система кеширования, в памяти и файлах. Часто меняющиеся данные кешируются через memcached, редко - через файловый кеш средствами APC PHP Accelerator. В настоящее время производится переход на использование MemcacheDB для оптимизации операций, требующих интенсивной записи в MySQL. Часть данных из MySQL будет перенесено в MemcacheDB, обеспечивающем, при неизменном с Memcached протоколе, гарантирование хранение данных на диске в Berkeley DB базе с поддержкой создания распределенных хранилищ.