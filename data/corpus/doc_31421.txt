В KDE планируют обеспечить поддержку дисплейного сервера Wayland

Мэйнтейнер оконного менеджера KWin сообщил о плане по обеспечению работы десктоп-окружения KDE поверх дисплейного сервера Wayland, в дополнение к изначально поддерживаемой работе поверх X-сервера. Интеграцию поддержки Wayland планируется произвести в три фазы, итогом которых станет обеспечение запуска KWin непосредственно поверх Wayland с предоставлением дополнительной прослойки для совместимости со старыми X-приложениями (для мобильных приложений будет предусмотрена возможность отключения данной прослойки). Первые две фазы будут завершены в следующем году в рамках цикла разработки KDE SC 4.8 и 4.9. Первую фазу планируется завершить зимой, а вторую летом 2012 года. Основная работа предстоит в направлении избавления KWin и других частей KDE от привязки к X11 и реализации нового уровня абстракции, который сможет взаимодействовать, как с X11, так и с Wayland. После того, как KWin будет абстрагирован от сиcтемы вывода, отмечается возможность портирования KWin не только на Wayland, но и на такие платформы, как Android, webOS и Windows. Кроме KWin адаптация для работы с Wayland потребуется для Plasma и других компонентов KDE, таких как утилита для создания скриншотов. В итоге, в течение 2012 года будет сформирован рабочий прототип, пригодный для использования в экспериментальном режиме. Пользователи смогут оценить работу поверх Wayland как штатной десктоп-оболочки KDE Plasma, так и оболочки Plasma Active, специально создаваемой для портативных устройств. Время полного завершения работы, когда использование KDE поверх Wayland станет полностью пригодным для конечных пользователей не фиксировано. По словам разработчиков, работа будет готова тогда, когда она будет готова. До появления первых Linux-дистрибутивов, поставляемых только с Wayland, без X-сервера, могут пройти годы. Сама по себе, связанная с Wayland инфраструктура еще не проработана и требует значительных доработок в направлении обеспечения поддержки со стороны видеодрайверов. Wayland еще достаточно молодой проект, который пока всерьез не принимают производители проприетарных драйверов NVIDIA и ATI/AMD, без которых невозможно повсеместное использование Wayland на Linux-десктопе. Тем не менее, компания Intel придерживается иного мнения о Wayland и ведет работу по интеграции его поддержки в платформу MeeGo. Если на классических десктопах пока трудно полностью перейти на альтернативу X11, то использование Wayland на мобильных устройствах может стать реальностью уже в ближайшем будущем - релиз MeeGo Tablet UX 1.3, базирующийся на Wayland, выйдет уже в этом году. Из проблем X11/X.Org Server отмечается отсутствие прямого взаимодействия (direct communication), необходимость исправлять недостатки X на уровне оконного менеджера, отсутствие поддержки перенаправления ввода, изначальная ориентированность X11 на некомпозитные среды (в композитном режиме вывод производится через промежуточный буфер, который затем выводится на экран в виде текстуры OpenGL, что позволяет добиться применимости визуальных эффектов к окнам). Например, для обеспечения надлежащей работы Compiz, разработчики данного композитного менеджера в течение нескольких лет поддерживают ряд патчей к X, которые так и не были приняты. Wayland лишен этих ограничений и проблем, а так же предоставляет некоторые новые возможности, такие как вложенный запуск серверов Wayland. Wayland отличается от X-сервера тем, что на уровне сервера выполняется только переадресация всех окон, а все операции рендеринга и управления окнами производятся на стороне клиента и передаются для обработки серверу со встроенным композитным менеджером. Сервер не поддерживает API отрисовки и оперирует только с уже сформированными окнами, что позволяет избавится от двойной буферизации при использовании таких библиотек как GTK+, Qt и Clutter. Все операции отрисовки производятся силами дополнительных библиотек, например, OpenGL ES, FreeType и Cairo. Взаимодействие с аппаратным обеспечением, например, проведение инициализации, переключение видеорежимов (drm modesetting) и управление памятью (GEM) графических карт, производится через KMS-модуль, работающий на уровне ядра, что позволяет обойтись без привилегий суперпользователя.