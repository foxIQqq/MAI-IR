Уязвимость в IDE-подсистеме QEMU позволяет скомпрометировать Xen, KVM и VirtualBox

В развиваемом проектом QEMU коде эмуляции подсистемы IDE выявлена критическая уязвимость (CVE-2015-5154), позволяющая инициировать выполнение кода вне гостевого окружения через передачу специально оформленных команд ATAPI. Уязвимость проявляется в системах x86/x86_64, работающих в режиме виртуализации с полной эмуляцией оборудования, таких как HVM-окружения Xen, VirtualBox и QEMU/KVM, при включении доступа к виртуальному CD-ROM из гостевой системы. В системах с паравиртуализацией и на архитектуре ARM уязвимость не проявляется. В случае успешной атаки злоумышленник, имеющий права root в гостевой системе, может выполнить произвольный код на стороне хост-системы с правами драйверов QEMU (обычно root, а при запуске в режиме stubdomain (qemu-dm) под отдельным непривилегированным пользователем). Проблема вызвана переполнением кучи в коде обработки доступа к буферу ввода/вывода в подсистеме IDE и проявляется при обработке некоторых команд ATAPI. Для оперативного устранения проблемы в QEMU подготовлен патч. Обновления пакетов с устранением уязвимости уже выпущены для RHEL, CentOS, SLES и openSUSE. Оценить появление обновлений в других дистрибутивах можно на следующих страницах: Ubuntu, Debian, Fedora, Slackware, Gentoo, FreeBSD, NetBSD. В качестве обходного пути защиты в RHEL/CentOS предлагается использовать sVirt и seccomp для ограничения привилегий процесса QEMU и ограничение доступа к ресурсам. В Ubuntu в конфигурации по умолчанию при использовании QEMU с libvirt применяется дополнительная изоляция при помощи AppArmor. Дополнительно сообщается об исправлении в RHEL ещё одной связанной с драйверами QEMU уязвимости (CVE-2015-3214), позволяющей привилегированному пользователю гостевой системы при редком стечении обстоятельств инициировать выполнение кода в окружении хост-системы. Проблема проявляется в системах с активированным PIT-режимом эмуляции QEMU и вызвана утечкой информации через функцию pit_ioport_read()