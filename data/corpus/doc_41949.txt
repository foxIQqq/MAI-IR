Первый выпуск инструментария для запуска приложений GNOME в изолированных контейнерах

Александр Ларсон (Alexander Larsson), активный разработчик GNOME и сопровождающий такие проекты, как Nautilus, Gnome-vfs и Dia, представил первый выпуск GNOME SDK runtime и инструментария xdg-app, предназначенного для организации распространения графических приложений в самодостаточных контейнерах, не привязанных к конкретному дистрибутиву Linux и надёжно изолирующих приложение от остальной системы. Контейнеры позволяют упростить распространение сторонних программ, не входящих в штатные репозитории дистрибутивов, за счет подготовки одного универсального контейнера без формирования отдельных сборок для каждого дистрибутива. Изолированное окружение формируется из двух компонентов: типового системного окружения (runtime), устанавливаемого через специальный репозиторий, и дополнительных зависимостей (bundle), связанных с приложением. В сумме runtime и bundle образуют начинку контейнера, при том, что runtime устанавливается отдельно и привязывается сразу к нескольким контейнерам, что позволяет обойтись без дублирования общих для контейнеров системных файлов. В одной системе может быть установлено несколько разных runtime (GNOME, KDE) или несколько версий одного runtime (GNOME 3.14, GNOME 3.16), в зависимости от требований используемых программ. Контейнер с приложением в качестве зависимости использует привязку только к определённому runtime, без учета отдельных пакетов, из которых состоит runtime. Все недостающие элементы упаковываются непосредственно вместе с приложением. При формировании контейнера содержимое runtime монтируется как раздел /usr, а bundle монтируется в директорию /self. GNOME SDK runtime выступает в роли аналога SDK для разработчиков контейнеров и включает помимо файлов, используемых для запуска программы, компоненты, требуемые для сборки приложения. Для формирования контейнера, запуска и управления его выполнением предоставляется специальная утилита xdg-app. Runtime сформированы для GNOME 3.16 и библиотек FreeDesktop. Утилита xdg-app уже помещена в corp-репозиторий Fedora 21 и 22. В качестве примеров сформированы контейнеры для gedit, GNOME Builder и glxgears. Для установки runtime достаточно выполнить "xdg-app install-runtime --user gnome-sdk org.gnome.Platform 3.16", а для загрузки приложения "xdg-app install-app --user test-apps org.gnome.gedit", предварительно подключив репозитории командой "xdg-app add-remote --user gnome-sdk http://sdk.gnome.org/repo/" и "xdg-app add-remote --user --no-gpg-verify test-apps https://people.gnome.org/~alexl/test-apps/repo/". Для запуска упакованной в контейнер программы можно использовать команду "xdg-app run org.gnome.gedit". Начинка runtime и контейнеров приложений формируется с использованием технологии OSTree, при которой образ атомарно обновляется из Git-подобного хранилища, позволяющего применять методы версионного контроля к компонентам дистрибутива (например, можно быстро откатить систему к прошлому состоянию). RPM-пакеты транслируются в репозиторий OSTree при помощи специальной прослойки rpm-ostree. Отдельная установка и обновление пакетов внутри рабочего окружения не поддерживается, система обновляется не на уровне отдельных компонентов, а целиком, атомарно меняя своё состояние. Предоставляются средства для инкрементального применения обновлений, избавляющие от необходимости полной замены образа при каждом обновлении. Формируемое изолированное окружение полностью независимо от используемого дистрибутива, не имеет доступа к файлам и процессам пользователя или основной системы, не может напрямую обращаться к оборудованию, за исключением вывода через DRI, и сетевой подсистеме. Вывод графики и организация ввода реализована при помощи протокола Wayland (X11 не поддерживается). Взаимодействия со внешней средой построено на основе системы обмена сообщениями kdbus. Для изоляции используются традиционные для Linux технологии контейнерной виртуализации, основанные на использовании cgroups, пространств имён (namespaces) и SELinux. Для вывода звука применяется PulseAudio.