Проблема с потерей данных на SSD при использовании ядра Linux 5.1, LVM и dm-crypt

В корректирующем выпуске ядра Linux 5.1.5 исправлена проблема в подсистеме DM (Device Mapper), которая может привести к повреждению данных на SSD-накопителях. Проблема стала проявляться после изменения, добавленного в ядро в январе этого года, затрагивает только ветку 5.1 и в подавляющем большинстве случаев проявляется на системах с SATA SSD-накопителями Samsung, на которых применяется шифрование данных с использованием dm-crypt/LUKS поверх device-mapper/LVM. Причиной проблемы является слишком агрессивная пометка освобождаемых блоков через FSTRIM (за раз помечалось слишком много секторов, без учёта лимита max_io_len_target_boundary). Из дистрибутивов, предлагающих ядро 5.1, ошибка уже устранена в Fedora, но пока остаётся неисправленной в ArchLinux (исправление доступно, но пока находится в ветке "testing". Дополнение: обновление выпущено). В качестве обходного пути блокирования проблемы называется отключение сервиса fstrim.service/timer, временное переименование исполняемого файла fstrim, исключение флага "discard" из числа опций монтирования в fstab и отключение режима "allow-discards" в LUKS через dmsetup.