Проблема, приводящая к потере данных при использовании в Linux SSD-накопителей Samsung

В SSD-накопителях Samsung серии 8xx выявлена проблема, которая может привести к потере данных при выполнении асинхронных операций TRIM. В частности, вместо очистки помеченных операционной системой удалённых данных, накопитель может очистить и часть актуальной информации. Очистка производится бессимптомно и обнаруживается при возвращении пустой области вместо ранее сохранённых данных. Проблема проявляется только в Linux, так как лишь данная ОС поддерживает асинхронные операции TRIM. В качестве способа предотвращения потери данных проблемные устройства занесены в специальный чёрный список libata, определяющий идентификаторы накопителей, для которых запрещено применять операцию TRIM. Неприятная особенность заключается в том, что не все модели проблемных устройств подпадают под созданный для TRIM чёрный список. Например, чёрный список не срабатывает для некоторых SSD-накопителей Samsung серий 8xx Evo/Pro и MZ7*. В качестве обходного решения предлагается запретить TRIM на всех моделях SSD-накопителей Samsung. Сведения о проблеме были опубликованы компанией Algolia, которая столкнулась с интересным эффектом, в результате которого время от времени на Linux-узлах кластера, использующего SSD-накопители, ext4-разделы непонятным образом переключались в режим только для чтения из-за повреждения данных. После восстановления целостности ФС через некоторое время ситуация проявлялась вновь. Детальный анализ проблемы показал, что эффект проявляется только при включении операции TRIM на некоторых видах SSD-накопителей. В результате сбоя контроллера SSD последние 512 байтов некоторых файлов обнулялись.