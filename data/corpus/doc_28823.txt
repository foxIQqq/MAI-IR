lock Отчёт о развитии OpenBSD за октябрь-ноябрь 2010 г.

Самые важные изменения за последние два месяца произошли в системе портов и направлены в первую очередь на удобство работы ответственных за порты (см. ниже). По традиции же сначала идёт список основных изменений в ядре и собственно системе: Новая опция -R для pfctl(8) позволяет указать номер правила при показе. Также pfctl(8) теперь корректно показывает использование опции divert-reply. В рамках интенсивно разрабатываемой поддержки платформы Octeon добавлена поддержка последовательных портов и CompactFlash-карт. Заметно переработаны драйверы для устройств PS/2, в частности, pms(4), что, в частности, исправило ряд проблем с тачпадами на современных нетбуках. Добавлена возможность фильтрации сообщений на роут-сокете по таблицам роутинга. По умолчанию теперь процесс получает только сообщения только для той таблицы роутинга, к которой он был привязан на момент открытия сокета. Приложение может изменить фильтр на другую таблицу, или же убрать его. Программы в базе и дереве портов, которым требуется отсутствие фильтрации, уже модифицированы для принудительного снятия фильтра. ifconfig(8) теперь позволяет указывать пароль для WPA напрямую, без использования (убранной за ненадобностью) wpa-psk(8) Убрана поддержка устройств srandom(4) и urandom(4) в пользу arandom(4), генератора псевдослучайных чисел, использующего движок ARC4 для выдачи длинных качественных псевдослучайных последовательностей, и постоянно пополняющего энтропию посредством random(9). В envy(4) добавлена поддержка MIDI-портов и исправлены проблемы работы на BE-архитектурах. Убрана поддержка блочного шифра SkipJack, как неактуального. Улучшения ikectl(8): Новая опция -q, реализующуя batch-режим (без запросов к пользователю). Также для реализации batch-режима теперь можно указывать пароли для CA и экспортируемых сертификатов в командной строке. Теперь можно создавать сертификаты, используемые для аутентификации только клиента или только сервера. Множество других, мелких изменений, направленных на более «естественное» поведение утилиты и удобство использования генерируемых ею сертификатов с другими VPN-средствами, не только isakmpd(8) и iked(8). OpenSSL обновлён до версии 1.0.0a, не считая патчей, связанных с недавно найденной уязвимостью в OpenSSL. Улучшена фильтрация кодом MPLS в ядре некорректных входных данным: например, маршруты с меткой MPLS_LABEL_IMPLNULL теперь отбрасываются сразу. Улучшена работа драйвера uvideo(4) и утилиты video(1) с малораспространёнными веб-камерами, а также с сообщающими неверную информацию о себе, вроде Kodak S100. Исправлена нашумевшая проблема с glob(3), вызывающая крайне высокий расход памяти, могущий привести к краху программы, при передаче (недоверенной стороной) специальным образом подобранных параметров. Ряд исправлений, улучшающих надёжность, внесён в trm(4). Из OpenSMTPd убран «новый» механизм организация очередей, исключительно в целях упрощения дальнейшей разработки. В дальнейшем возможно его возвращение, так как жалоб на его работу не имеется. Gilles Chehade, основной разработчик OpenSMTPd, обещает вернуть заложенные идеи позднее, после реализации некоторых важных для MTA функций. Исправлены проблемы с детектом udl(4) Исправлена крупная утечка памяти в relayd(8). hexdump(1) теперь лучше работает с медленными источниками данных. mandoc(1) теперь лучше документирован и успешно собирает страницы руководств Xenocara, а также многих портов (см. ниже). Также небольшие изменения и улучшения были произведены в подсистеме ACPI, envy(4), IPv6-стеке, Заметные изменения в системе портов: Добавлена простая, собственная система автозапуска сервисов. Поддерживаются команды start, stop, reload, restart и check. Используется следующим образом: Для порта создаётся один или несколько rc-файлов. Они помещаются в подкаталог pkg/ порта и регистрируются в списке упаковки (packing list). При сборке бинарного пакета они будут автоматически вложены командой pkg_create(1), а при установке посредством pkg_add(1) — автоматически будут помещены в /etc/rc.d. Для того, чтобы сервисы автоматически запускались и останавливались вместе с системой, достаточно добавить их названия в /etc/rc.conf.local в переменную rc_scripts. Изменена семантика LIB_DEPENDS и WANTLIB: теперь конкретные версии требуемых библиотек указываются в WANTLIB, а система портов самостоятельно связывает пакеты в LIB_DEPENDS и спецификации из WANTLIB. Изменён формат спецификаций зависимостей. Убраны лишние двоеточия (вместо ::category/portname теперь следует писать просто category/portname), добавлена сокращённая форма с ключевым словом STEM (вместо p5-Data-Visitor->=0.24:devel/p5-Data-Visitor можно писать STEM->=0.24:devel/p5-Data-Visitor). В WANTLIB теперь не нужно указывать лишние точки (вместо xml2.>=9 теперь xml2>=9). Новая опция для использования в особых случаях: PKGSPEC. Нужна для тех случаев, когда механизм автоматического определения спецификации зависимостей не может выдать правильный ответ и во всех зависимых портах приходится прописывать не только pkgpath, но и спецификацию. Например, это происходит с autoconf-*. Теперь достаточно указать, скажем, в порте GNU Autoconf 2.59 прописать PKGSPEC=autoconf-2.59, и все порты, имеющие BUILD_DEPENDS=devel/autoconf/2.59 автоматически получат спецификацию autoconf-2.59 вместо autoconf-*. В системе портов теперь также по умолчанию используется mandoc(1) для форматирования man-страниц. В тех портах, где mandoc по тем или иным причинам не справляется, ставится пометка USE_GROFF=Yes, при наличии которой GNU groff автоматически добавляется в зависимости и используется для форматирования man-страниц. Ещё ряд портов переведён на использование собственной версии libtool. Осталось всего 53 порта (из более чем 1300), использующих libtool, которым требуется версия libtool от GNU, причём в большинстве случаев реально требуется только скрипт libtoolize, а собственно GNU libtool участия в сборке не принимает. Жёстко зафиксировано правило форматирования новых Makefile: пробел между названием переменой и «=», и один или более символов табуляции или пробела после «=». Исправлено много небольших багов в dpb3 (Distributed Port Builder 3) и добавлено много приятных мелочей, вроде мониторинга изменений версий портов, учитываяющая ревизии портов. Предыдущая версия dpb окончательно убрана из инфраструктуры. dpb3 удобно использовать даже на одной машине, он позволяет грамотно распараллелить сборку портов с множеством зависимостей, автоматически чистит папки после успешной сборки и ведёт подробные логи всего процесса. Следует отметить, что все вышеперечисленные изменения уже проведены над всеми или почти всеми соответствующими портами, поэтому деревом портов из -CURRENT можно пользоваться безбоязненно. Из прочих изменений следует отметить импорт LibreOffice (включён в сборку) и TexLive 2010 (ещё не включён в сборку), а также свежей версии qemu (старая версия 0.10, более уверенно работающая на некоторых архитектурах, так же оставлена). Интересующимся также, возможно, будет интересно посмотреть несколько презентаций с недавно прошедшей конференции EuroBSDCon: «Distributed Port Builds in OpenBSD» — организация процесса распределённой сборки сторонних программных пакетов. «The long long road to pkg_add -u» — обзор проблем, связанных с обновлением установленных программных пакетов, и применённых в OpenBSD решений. «Placeholders» — рассказ о развитии PF. «OpenBSD update» — краткое перечисление последних крупных внутренних изменений в OpenBSD. Хотя первые две презентации и были опубликованы до последних изменений в системе портов, однако актуальности они не потеряли, так как рассказывают о других, слабо связанных темах.