Разработчики OpenBSD экспериментируют с использованием Wayland

На прошедшем в Таллине хакатоне g2k23 разработчики проекта OpenBSD провели эксперимент по запуску в OpenBSD графического окружения, использующего протокол Wayland. До сих пор для формирования графического окружения в OpenBSD применялась собственная редакция X11-стека - Xenocara, основанная на библиотеках X.Org 7.7, X Server 1.21.6 и Mesa 22.3.4. Участники хакатона исследовали вопрос применения в OpenBSD отличных от X11 систем и попытались создать окружение на основе композитного менеджера Sway, построенного с использованием протокола Wayland и совместимого с мозаичным оконным менеджером i3 и панелью i3bar. Мероприятие показало, что в OpenBSD вполне реально организовать работу окружения на базе Wayland, несмотря на то, что предложенное решение ещё не может рассматриваться как полноценно работающая система и требует доработки. Помимо Sway в окружении была задействована модифицированная для работы в OpenBSD библиотека wlroots, предоставляющая базовые функции для организации работы композитного менеджера на базе Wayland. Для вывода использовался порт Mesa для OpenBSD. Для управления сеансом и организации доступа к совместно используемым устройствам ввода и вывода задействованы порты библиотеки libseat и фонового процесса seatd. Для организации ввода использовались порты libudev-openbsd, libevdev-openbsd и libinput-openbsd. Для запуска X-приложений из Sway применялся порт Xwayland. В качестве Wayland-приложений запускались эмулятор терминала havoc и просмотрщик изображений swayimg. Подготовлены патчи, позволившие запустить набор демонстраций gtk3-demo, но для выполнения более сложных GTK-приложений требуется внесение дополнительных изменений (при помощи XWayland, GTK-приложения, такие как Emacs и Firefox, запускаются без проблем). Удалось собрать Qt 5 и 6 с поддержкой Wayland, но при попытке их использования всплыли проблемы, требующие внесения исправлений. Также требуют дополнительной отладки периодические крахи ядра при работе композитного менеджера Sway (предполагается, что проблема в dri-драйвере для GPU Intel Iris).