Релиз сетевого конфигуратора NetworkManager 1.40.0

Доступен стабильный релиз интерфейса для упрощения настройки параметров сети - NetworkManager 1.40.0. Плагины для поддержки VPN (Libreswan, OpenConnect, Openswan, SSTP и др.) развиваются в рамках собственных циклов разработки. Основные новшества NetworkManager 1.40: В интерфейсе командной строки nmcli реализован флаг "--offline", позволяющий обрабатывать профили соединений в формате keyfile без обращения к фоновому процессу NetworkManager. В частности, при создании, отображении, удалении и изменении привязанных к сетевому интерфейсу настроек, команда "nmcli connection" теперь может работать без обращается к фоновому процессу NetworkManager через D-Bus. Например, при выполнении команды "nmcli --offline connection add ..." утилита nmcli не будет отправлять фоновому процессу запрос на добавление профиля соединения, а напрямую выведет в stdout соответствующий блок настроек в формате keyfile, что позволяет использовать nmcli в скриптах для генерации и изменения профилей соединений. Для активации созданный профиль можно сохранить в каталоге /etc/NetworkManager/system-connections. # Настраиваем сохранение файлов с правами "600" (доступны только владельцу). umask 077 # Генерируем профиль в формате keyfile. nmcli --offline connection add type ethernet con-name my-profile \ | tee /etc/NetworkManager/system-connections/my-profile.nmconnection # Изменяем профиль nmcli --offline connection modify connection.mptcp-flags enabled,signal \ < /etc/NetworkManager/system-connections/my-profile.nmconnection \ | tee /etc/NetworkManager/system-connections/my-profile.nmconnection~ mv /etc/NetworkManager/system-connections/my-profile.nmconnection~ \ /etc/NetworkManager/system-connections/my-profile.nmconnection # После перезаписи профиля на диске перезагружаем настройки NetworkManager nmcli connection reload Добавлена поддержка MPTCP (Multipath TCP), расширения протокола TCP для организации работы TCP-соединения с доставкой пакетов одновременно по нескольким маршрутам через разные сетевые интерфейсы, привязанные к разным IP-адресам. NetworkManager теперь может управлять IP-адресами, анонсируемыми или используемыми в дополнительных потоках MPTCP, в том числе настраивать данные адреса автоматически, по аналогии с тем, как это делает процесс mptcpd. NetworkManager также поддерживает включение MPTCP в ядре через выставление sysctl /proc/sys/net/mptcp/enabled и настройку ограничений, задаваемых командой "ip mptcp limits". Для управления обработкой MPTCP предложено новое свойство "connection.mptcp-flags", через которое можно включить MPTCP и выбрать параметры назначения адресов (signal, subflow, backup, fullmesh). По умолчанию MPTCP включается в NetworkManager автоматически, если в ядре выставлен sysctl /proc/sys/net/mptcp/enabled. Обеспечена запись параметров привязки IP-адресов для DHCP (DHCP lease) в файл /run/NetworkManager/devices/$IFINDEX (информация сохраняется в секциях [dhcp4] и [dhcp6]), что позволяет определять привязки через простое чтение файла без обращения к D-Bus или выполнения команды "nmcli -f all device show eth0". В профиль соединения добавлен параметр ipv4.link-local для привязки локальных линков IPv4 с интранет адресами 169.254.0.0/16 (IPv4LL, Link-local). Ранее адреса IPv4LL могли быть указаны либо вручную (ipv4.method=link-local), либо получены через DHCP. Добавлен параметр "ipv6.mtu" для настройки MTU (Maximum Transmission Unit) для IPv6. Удалён код неиспользуемой реализации клиента DHCPv4, основанной на коде из systemd. В качестве DHCP-клиента давно используется реализация n-dhcp4 из пакета nettools. Обеспечен перезапуск DHCP при изменении MAC-адреса на устройстве.