Атака против WPA2, позволяющая перехватить трафик в WiFi-сети

Раскрыты детали новой техники атаки KRACK (Key Reinstallation Attacks), позволяющей вклиниться в беспроводное соединение на базе технологии WPA2 и организовать перехват или подстановку трафика без подключения к беспроводной сети и без определения пароля доступа. Новая техника атаки сводит на нет уровень защиты WPA2, делая работу через WPA2 не более защищённой чем, работа в публичной WiFi-сети. Всем пользователям рекомендуется обязательно использовать дополнительные уровни защиты при работе с конфиденциальными данными при соединении через WPA2, такие как VPN или обращение к ресурсам только по HTTPS. Атака затрагивает концептуальную недоработку в стандарте WPA2, что делает уязвимыми все корректные реализации стандарта, независимо от применяемых шифров (WPA-TKIP, AES-CCMP, GCMP). В том числе наличие проблемы подтверждено в Android, Linux, macOS, iOS, Windows, OpenBSD, MediaTek и Linksys. Наибольшей опасности подвержены пользователи пакета wpa_supplicant, для которого проведение атаки существенно упрощается, так как в версиях wpa_supplicant 2.4+ дополнительно найдена уязвимость, при помощи которой атакующие могут перевести соединение на работу с пустым ключом шифрования и полностью контролировать трафик. Дополнительная уязвимость в wpa_supplicant 2.4+ связана с тем, что в коде предполагается, что ключ используется только один раз, поэтому после установки он очищается из памяти, а операция переустановки приводит к использованию уже очищенного ключа. Wpa_supplicant 2.4 используется в платформе Android 6+ и многих дистрибутивах Linux, что делает данные системы наиболее уязвимыми при доступе в сеть через WPA2. Для других реализаций WPA2 опасность не столь велика и возможна лишь выборочная расшифровка кадров. Атака сводится к инициированию процесса перенастройки сессионных ключей шифрования WPA/WPA2/RSN (TK, GTK или IGTK), путём отправки клиенту специально оформленного кадра. Подобная перенастройка может быть использована злоумышленником для отключения защиты от повторного воспроизведения и существенного снижения стойкости шифрования до уровня, позволяющего, в зависимости от применяемого шифра, выполнить расшифровку содержимого передаваемых кадров или определить части ключей шифрования. В частности, так как атакующий добивается переустановки уже используемого ключа в процессе согласования соединения, то осуществляется сброс привязанного к соединению номера передаваемых пакетов (в WPA2 номер пакета используется в качестве вектора инициализации, nonce) и сбрасывается счётчик полученных ответов. Таким образом появляется возможность повторного использования одноразового значения "nonce". В зависимости от настроек беспроводной сети атакующий может организовать прослушивание трафика или манипуляцию данными, например, осуществить подстановку вредоносного кода на страницы сайтов, получаемые без HTTPS. Опасность проблемы сглаживает то, что уязвимость может быть устранена без нарушения обратной совместимости, путём наложения патча на стороне клиента. Точки доступа проблема затрагивает только, если они работают в режиме клиента или включен 802.11R (Fast Roaming, обычно не активируется по умолчанию). Продемонстрированный метод атаки касается только клиентов и обеспечивает перехват трафика только от клиента. Двунаправленный перехват возможен в случае применения на точке доступа 802.11R. Проблема будет устранена в hostapd/wpa_supplicant 2.7, но уже доступны патчи и пакеты с исправлением сформированы для Debian, Fedora, ALT, ROSA, Arch и Ubuntu (в ближайшие часы обновления ожидаются для RHEL, SUSE и FreeBSD). Из производителей оборудования обновление прошивки выпустили Mikrotik, Netgear, Ubiquiti и Aruba. Обновление для точек доступа Zyxel запланировано на февраль 2018 года. В OpenBSD проблема была устранена ещё в конце августа, так как разработчики данной системы отказались откладывать исправление до окончания эмбарго, но согласились не афишировать связь исправления с уязвимостью до общего анонса. Дополнение: Microsoft также нарушил эмбарго и 10 октября выпустил исправление в составе обновления KB4041676, без явного упоминания в списке исправлений.