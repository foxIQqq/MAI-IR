Возобновление работы по интеграции поддержки Tor в Firefox

На проходящей в эти дни в Стокгольме встрече разработчиков Tor отдельная секция посвящена вопросам интеграции Tor и Firefox. Ключевые задачи сводятся к созданию дополнения, обеспечивающего работу через анонимную сеть Tor в штатном Firefox, а также к переносу разработанных для Tor Browser патчей в основной состав Firefox. Для отслеживания состояния переноса патчей подготовлен специальный сайт torpat.ch. Перенесено пока 13 патчей, а для 22 патчей заведены обсуждения в багтрекере Mozilla (всего предложено более сотни патчей). Основная идея по интеграции с Firefox заключается в использовании Tor при работе в приватном режиме или в создании дополнительного суперприватного режима с Tor. Так как включение поддержки Tor в основой состав Firefox требует большой работы, решено начать с разработки внешнего дополнения. Дополнение будет поставляться через каталог addons.mozilla.org и будет включать кнопку для включения режима работы через Tor. Поставка в форме дополнения позволит оценить общую концепцию того, как может выглядеть встроенная поддержка Tor. Код для работы с сетью Tor планируется не переписывать на JavaScript, а скомпилировать из Си в представление WebAssembly, что позволит включить все необходимые проверенные компоненты Tor в состав дополнения без привязки к внешним исполняемым файлам и библиотекам. Проброс в Tor будет организован через изменение настроек прокси и использование собственного обработчика в качестве прокси. При переходе в режим работы через Tor дополнение также будет менять некоторые настройки, связанные с безопасностью. В частности, будут применены похожие на Tor Browser настройки, нацеленные на блокирование возможных путей обхода прокси и противостоящие идентификации системы пользователя. При этом для работы дополнения потребуются расширенные привилегии, выходящие за рамки обычных дополнений на базе API WebExtension и свойственные системным дополнениям (например, дополнение будет напрямую вызывать функции XPCOM). Подобные привилегированные дополнения должны быть заверены цифровой подписью Mozilla, но так как дополнение предлагается развивать совместно с Mozilla и поставлять от имени Mozilla, с получением дополнительных привилегий не должно возникнуть проблем. Интерфейс Tor-режима пока обсуждается. Например, предлагается при клике на кнопку Tor открывать новое окно с отдельным профилем. В режиме Tor также предлагается полностью запретить отправку запросов по HTTP, так как содержимое незашифрованного трафика может быть перехвачено и модифицировано на выходящих узлах Tor. Защита от подстановки изменений в HTTP трафик через использование NoScript признана недостаточной, поэтому проще ограничить Tor режим только запросами через HTTPS.