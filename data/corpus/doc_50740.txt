В Wayland-сеансе GNOME 3.34 будет обеспечен запуск XWayland по мере необходимости

В код оконного менеджера Mutter, развиваемый в рамках цикла разработки GNOME 3.34, включены изменения, позволяющие автоматизировать запуск XWayland при попытке выполнения приложения на базе протокола X11 в графическом окружении на основе протокола Wayland. Отличие от поведения GNOME 3.32 и более ранних выпусков состоит в том, что до сих пор компонент XWayland выполнялся постоянно и требовал явного предварительного запуска (запускался при инициализации сеанса GNOME), а теперь будет запускаться динамически при появлении необходимости в компонентах для обеспечения совместимости с X11. Выпуск GNOME 3.34 запланирован на 11 сентября 2019 года. Напомним, что для обеспечения выполнения обычных X11-приложений в окружении на базе Wayland используется DDX-компонент XWayland (Device-Dependent X), который развивается в составе основной кодовой базы X.Org. По организации работы XWayland напоминает Xwin и Xquartz для платформ Win32 и OS X и включает компоненты для запуска X.Org Server поверх Wayland. Внесённое в Mutter изменение позволит запускать X-сервер только когда в этом имеется необходимость, что положительно отразится на потреблении ресурсов в системах, не использующих приложения X11 в окружении Wayland (процесс с X-сервером обычно занимает более сотни мегабайт оперативной памяти). Тем временем, Ганс Де Гоеде (Hans de Goede) представил два отчёта с перечислением проблем, возникающих при повседневной работе с рабочим столом GNOME на базе Wayland, которые планируется исправить в рамках недавно запущенной инициативы по избавлению GNOME от специфичных для Wayland проблем. Ганс получил более 40 сообщений о проблемах и попытался их структурировать. Многие проблемы связаны поддержкой клавиатурного ввода и переключением раскладки, не всегда работает Drag and drop, в XWayland нет нормальной поддержки HiDPI, наблюдаются подвисания курсора мыши, для Wayland-приложений не реализовано сворачивание окон средним кликом мышью на заголовке, не работает запуск графических приложений через sudo или pxexec. Отдельно представлен разбор двух проблем, возникающих при запуске игр: уменьшение видимой области с выводом чёрных рамок при использовании полноэкранного режима и низкая производительность в полноэкранном режиме. Дополнение: В XWayland добавлен GLX-обработчик на базе программного интерфейса EGL, который используется для обращения к функциям рендеринга в Wayland. Изменения войдут в состав выпуска X.Org Server 1.21. Использование EGL для настройки примитивов GLX позволит исключить применение программного растеризатора swrast. Применение swrast приводило к проблемам при запуске X11-игр, требующих настроек сглаживания MSAA (Multi-Sample AntiAliasing), информация о которых не предоставляется в llvmpipe. Предложенное изменение позволяет формировать передаваемую GLX-клиентам информацию о возможностях GL-стека на основе данных от EGL, в том числе предоставить доступ к конфигурациям MSAA для запускаемых под управлением XWayland игр, таких как Hearts of Iron IV, Stellaris и Europa Universalis IV. Изменение также даст возможность снять с X-сервера функции загрузчика DRI-драйвера.