Oracle портирует под Linux системы DTrace и Zones

В представленной на конференции OpenWorld презентации, посвященной грядущим новшествам дистрибутива Oracle Linux, упомянуто портирование под Linux технологии динамической отладки DTrace и системы легковесных изолированных контейнеров Solaris Zones (в презентации Oracle упоминается лишь Linux Containers, но в блоге одного из разработчиков DTrace упоминается, что речь о портировании Zones). Технологии планируют интегрировать в следующий значительный релиз ядра Unbreakable Enterprise Kernel. Следует отметить, что в рамках проекта CRiSP с 2008 года развивается порт DTrace для Linux, работающий в виде модуля ядра. Разработчики данного проекта встревожены шагом Oracle, но не исключают того, что это лишь маркетинговая уловка. Подкрепляет данное предположение и то, что детальной информацией не обладает никто, даже сотрудники Oracle -- подобное объявление стало неожиданностью, например, для некоторых разработчиков Solaris. Интеграцию DTrace в Linux усложняла необходимость реализации большого числа контрольных вызовов (probes) в ядре Linux, что требовало внесения большого объёма типовых изменений. Например, в ядро Solaris для обеспечения полноценной поддержки DTrace внесено около 20 тысяч подобных контрольных вызовов. Oracle поддерживает свою ветку ядра Linux для дистрибутива Oracle Linux, т.е. теоретически может реализовать нужную функциональность. Но возникает проблема с поддержкой проделанного объема работы и синхронизацией с основным деревом ядра Linux, в которое поддержка DTrace не может быть принята в силу лицензионной несовместимости. Решить проблему могла бы смена лицензии на DTrace с CDDL на GPL, но Oracle не планирует идти на такой шаг и хочет ограничиться применением двойной лицензии для небольшой части кода (заголовочные файлы и жёстко прошитый в ядро код), оставив основной код, включая модуль ядра, под CDDL. Адам Левенталь (Adam Leventhal), один из основных разработчиков DTrace, в прошлом году покинувший Oracle, в своём блоге высказал удивление подобным поворотом событий. Несколько лет назад, во время работы в Sun Microsystems, Адам обеспечил возможность использования DTrace для Linux-приложений, работающих в BrandZ (изолированное Linux-окружение, работающее поверх ядра Solaris) и разработал стратегию реализации DTrace на базе ядра Linux, поэтому тема портирования DTrace в Linux ему близка. Известно, что работа пока сосредоточена только вокруг реализации части DTrace, работающей на уровне ядра системы. Также известно, что DTrace для Linux пока не проходит тестовый комплект DTrace test suite, т.е. находится на начальной стадии развития. Явно не упоминается, ведётся ли речь только о провайдере fbt (Function Boundary Tracing, отслеживает вход и выход из функций ядра) или уже реализованы провайдеры статической трассировки приложений и провайдеры для планировщика задач). Примечательно, что для Linux развивается собственная технология динамической трассировки SystemTap, во многом похожая на DTrace по выполняемым задачам. Среди компаний, участвующих в развитии данной системы, кроме Red Hat, IBM, Intel и Hitachi, также числится и Oracle. Как и DTrace, SystemTap позволяет организовать доскональное наблюдение за работающей системой, производить сбор статистики о работе приложений, выполнять профилирование, контролировать работу системных вызовов. Управление производится через интерфейс командной строки и специальный Си-подобный язык сценариев. Тем не менее, в прошлом некоторые известные разработчики ядра Linux, например, Тед Тц'о (Ted Ts’o), автор файловых систем семейства Ext, высказывались с критикой SystemTap, считая данную систему непригодной к использованию, в отличие от DTrace, которая "просто работает". Кроме того, SystemTap поставляется только в составе Fedora Linux и RHEL, и не включена в основное ядро Linux.