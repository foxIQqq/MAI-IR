Выпуск OpenWrt 22.03.0

После года разработки опубликован новый значительный выпуск дистрибутива OpenWrt 22.03.0, ориентированного на применение в различных сетевых устройствах, таких как маршрутизаторы, коммутаторы и точки доступа. OpenWrt поддерживает множество различных платформ и архитектур и обладает системой сборки, позволяющей просто и удобно производить кросс-компиляцию, включая в состав сборки различные компоненты, что позволяет легко сформировать адаптированную под конкретные задачи готовую прошивку или образ диска с желаемым набором предустановленных пакетов. Сборки сформированы для 35 целевых платформ. Из изменений в OpenWrt 22.03.0 отмечается: По умолчанию задействовано новое приложение для управления межсетевым экраном - fw4 (Firewall4), основанное на пакетном фильтре nftables. Синтаксис файлов конфигурации для межсетевого экрана (/etc/config/firewall) и интерфейс uci не изменились - fw4 может выступать прозрачной заменой ранее применявшегося инструментария fw3, основанного на iptables. Исключение составляют правила добавленные вручную (/etc/firewall.user), которые потребуется переделать для nftables (fw4 позволяет добавлять собственные блоки правил, но в формате nftables). Старый инструментарий на базе iptables исключён из предлагаемых по умолчанию образов, но может быть возвращён при помощи пакетного менеджера opkg или инструментария Image Builder. Также предоставлены обвязки iptables-nft, arptables-nft, ebtables-nft и xtables-nft, позволяющие создавать для nftables правила с использованием старого синтаксиса iptables. Добавлена поддержка более 180 новых устройств, в том числе 15 устройств на базе чипа MediaTek MT7915 с поддержкой Wi-Fi 6 (IEEE 802.11ax). Общее число поддерживаемых устройств достигло 1580. Продолжен перевод целевых платформ на использование подсистемы ядра DSA (Distributed Switch Architecture), предоставляющей средства для настройки и управления каскадами соединённых между собой Ethernet-коммутаторов, применяя механизмы для настройки обычных сетевых интерфейсов (iproute2, ifconfig). DSA может применяться для настройки портов и VLAN вместо ранее предлагаемого инструмента swconfig, но не все драйверы коммутаторов пока поддерживают DSA. В предложенном выпуске DSA задействован для платформ bcm53xx (переведены драйверы для всех плат), lantiq (SoC на базе xrx200 и vr9) и sunxi (платы Bananapi Lamobo R1). Ранее на DSA были переведены платформы ath79 (TP-Link TL-WR941ND), bcm4908, gemini, kirkwood, mediatek, mvebu, octeon, ramips (mt7621) и realtek. В Web-интерфейсе LuCI реализован тёмный режим оформления. По умолчанию режим автоматически включается в зависимости от настроек браузера, но его также можно принудительно включить через меню "System" -> "System" -> "Language and Style". Решена проблема 2038 года, вызванная переполнением 32-разрядного типа time_t (32-разрядный эпохальный счётчик времени переполнится 19 января 2038 года). В новом выпуске в качестве стандартной библиотеки задействована ветка musl 1.2.x, в которой на 32-разрядных архитектурах старые 32-разрядные счётчики времени заменены на 64-разрядные (тип time_t заменён на time64_t). На 64-разрядных системах тип time64_t используется изначально (счётчик переполнится через 292 миллиарда лет). Переход на новый тип привёл к изменению ABI, что потребует пересборки всех 32-разрядных программ, связанных с musl libc (для 64-разрядных программ пересборка не требуется). Обновлены версии пакетов, включая ядро Linux 5.10.138 с портированием беспроводного стека cfg80211/mac80211 из ядра 5.15.58 (ранее предлагалось ядро 5.4 с беспроводным стеком из ветки 5.10), musl libc 1.2.3, glibc 2.34, gcc 11.2.0, binutils 2.37, hostapd 2.10, dnsmasq 2.86, dropbear 2022.82, busybox 1.35.0. Прекращено формирование сборок для платформы arc770 (Synopsys DesignWare ARC 770D).