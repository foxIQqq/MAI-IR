Удалённая уязвимость в ядре Linux, проявляющаяся при использовании протокола TIPC

В модуле ядра Linux, обеспечивающем работу сетевого протокола TIPC (Transparent Inter-process Communication), выявлена уязвимость (CVE-2022-0435), потенциально позволяющая выполнить свой код на уровне ядра через отправку специально оформленного сетевого пакета. Проблема затрагивает только системы с загруженным модулем ядра tipc.ko и настроенным стеком TIPC, который обычно используется в кластерах и по умолчанию не активирован в неспециализированных дистрибутивах Linux. Отмечается, что при сборке ядра в режиме "CONFIG_FORTIFY_SRC=y" (применяется в RHEL), добавляющем дополнительные проверки границ в функцию memcpy(), эксплуатация ограничивается аварийной остановкой работы (ядро впадает в состояние panic). При выполнении без дополнительных проверок и при утечке сведений о канареечных метках, применяемых для защиты стека, проблема может быть использована для удалённого выполнения кода с правами ядра. Выявившие проблему исследователи заявляют, что техника эксплуатации тривиальна и будет раскрыта после повсеместного устранения уязвимости в дистрибутивах. Уязвимость вызвана переполнением стека, происходящем при обработке пакетов, значение поля с числом узлов участников домена, в которых превышает 64. Для хранения параметров узлов в модуле tipc.ko используется фиксированный массив "u32 members[64]", но в процессе обработки указанного в пакете номера узла не выполняется проверка значения "member_cnt", что позволяет использовать значения больше 64 для контролируемой перезаписи данных в области памяти, следующей в стеке после структуры "dom_bef". Приводящая к уязвимости ошибка была внесена 15 июня 2016 года и вошла в состав ядра Linux 4.8. Уязвимость устранена в выпусках ядра Linux 5.16.9, 5.15.23, 5.10.100, 5.4.179, 4.19.229, 4.14.266 и 4.9.301. В ядрах большинства дистрибутивов проблема пока остаётся неисправленной: RHEL, Debian, Ubuntu, SUSE, Fedora, Gentoo, Arch Linux. Протокол TIPC изначально разработан компанией Ericsson, предназначен для организации межпроцессного взаимодействия в кластере и активируется главным образом на узлах кластеров. TIPC может работать как поверх Ethernet, так и поверх UDP (сетевой порт 6118). В случае работы поверх Ethernet атака может быть совершена из локальной сети, а при использовании UDP - из глобальной сети, если порт не прикрыт межсетевым экраном. Атака также может быть совершена непривилегированным локальным пользователем хоста. Для активации TIPC необходима загрузка модуля ядра tipc.ko и настройка привязки к сетевому интерфейсу при помощи netlink или утилиты tipc.